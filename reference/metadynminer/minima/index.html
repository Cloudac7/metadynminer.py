
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.5.4">
    
    
      
        <title>Minima - metadynminer.py</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.80dcb947.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="lightgreen">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-metadynminerminima" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="metadynminer.py" class="md-header__button md-logo" aria-label="metadynminer.py" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            metadynminer.py
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Minima
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Cloudac7/metadynminer.py" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    metadynminer.py
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="metadynminer.py" class="md-nav__button md-logo" aria-label="metadynminer.py" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    metadynminer.py
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Cloudac7/metadynminer.py" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    metadynminer.py
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../docs/example/tutorial/" class="md-nav__link">
        Tutorial
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Metadynminer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Metadynminer" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Metadynminer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fes/" class="md-nav__link">
        Fes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hills/" class="md-nav__link">
        Hills
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Minima
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Minima
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minima" class="md-nav__link">
    Minima
  </a>
  
    <nav class="md-nav" aria-label="Minima">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findminima" class="md-nav__link">
    findminima
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make_gif" class="md-nav__link">
    make_gif
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot" class="md-nav__link">
    plot
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../profile/" class="md-nav__link">
        Profile
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minima" class="md-nav__link">
    Minima
  </a>
  
    <nav class="md-nav" aria-label="Minima">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findminima" class="md-nav__link">
    findminima
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make_gif" class="md-nav__link">
    make_gif
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot" class="md-nav__link">
    plot
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/Cloudac7/metadynminer.py/edit/main/reference/metadynminer/minima.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="module-metadynminerminima">Module metadynminer.minima</h1>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="s s-Atom">import</span> <span class="s s-Atom">sys</span>

<span class="s s-Atom">import</span> <span class="s s-Atom">numpy</span> <span class="s s-Atom">as</span> <span class="s s-Atom">np</span>

<span class="s s-Atom">import</span> <span class="s s-Atom">pandas</span> <span class="s s-Atom">as</span> <span class="s s-Atom">pd</span>

<span class="s s-Atom">from</span> <span class="s s-Atom">itertools</span> <span class="s s-Atom">import</span> <span class="s s-Atom">product</span>

<span class="s s-Atom">from</span> <span class="s s-Atom">typing</span> <span class="s s-Atom">import</span> <span class="nv">Optional</span><span class="p">,</span> <span class="nv">List</span>

<span class="s s-Atom">from</span> <span class="s s-Atom">metadynminer</span><span class="p">.</span><span class="s s-Atom">fes</span> <span class="s s-Atom">import</span> <span class="nv">Fes</span>

<span class="s s-Atom">class</span> <span class="nv">Minima</span><span class="o">:</span>

    <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    Represents an object of the Minima class used to find local free energy minima on a free energy surface (FES).</span>

<span class="s2">    The FES is divided into a specified number of bins (default is 8), and the absolute minima is found for each bin.</span>

<span class="s2">    The algorithm then checks if each found point is a local minimum by comparing it to the surrounding points on the FES.</span>

<span class="s2">    The list of minima is stored as a pandas DataFrame.</span>

<span class="s2">    Usage:</span>

<span class="s2">    ```python</span>

<span class="s2">    minima = metadynminer.Minima(fes=f, nbins=8)</span>

<span class="s2">    ```</span>

<span class="s2">    The list of minima can be accessed using the `minima.minima` attribute:</span>

<span class="s2">    ```python</span>

<span class="s2">    print(minima.minima)</span>

<span class="s2">    ```</span>

<span class="s2">    Args:</span>

<span class="s2">        fes (Fes): The Fes object to find the minima on.</span>

<span class="s2">        nbins (int, default=8): The number of bins used to divide the FES.</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="s s-Atom">def</span> <span class="k">__</span><span class="nf">init__</span><span class="p">(</span>

        <span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">fes</span><span class="p">:</span> <span class="nv">Fes</span><span class="p">,</span> <span class="s s-Atom">nbins</span><span class="o">=</span><span class="mi">8</span>

    <span class="p">)</span><span class="o">:</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">fes</span> <span class="o">is</span> <span class="nv">None</span><span class="o">:</span>

            <span class="s s-Atom">raise</span> <span class="nv">ValueError</span><span class="p">(</span><span class="s2">&quot;FES is not defined.&quot;</span><span class="p">)</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span> <span class="o">=</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">fes</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">periodic</span> <span class="o">=</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">periodic</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_select</span> <span class="o">=</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">cv_select</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_select</span><span class="p">)</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span> <span class="o">=</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">res</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_name</span> <span class="o">=</span> <span class="p">[</span><span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">hills</span><span class="p">.</span><span class="s s-Atom">cv_name</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">]</span> <span class="s s-Atom">for</span> <span class="s s-Atom">i</span> <span class="s s-Atom">in</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_select</span><span class="p">]</span>

        <span class="s s-Atom">#</span> <span class="s s-Atom">use</span> <span class="s s-Atom">remapped</span> <span class="s s-Atom">cv_min</span> <span class="s s-Atom">and</span> <span class="s s-Atom">cv_max</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span> <span class="o">=</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">cv_min</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span> <span class="o">=</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">cv_max</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_per</span> <span class="o">=</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">hills</span><span class="p">.</span><span class="s s-Atom">cv_per</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">findminima</span><span class="p">(</span><span class="s s-Atom">nbins</span><span class="o">=</span><span class="s s-Atom">nbins</span><span class="p">)</span>

    <span class="s s-Atom">def</span> <span class="nf">findminima</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">nbins</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span>

        <span class="s2">&quot;&quot;&quot;Method for finding local minima on FES.</span>

<span class="s2">        Args:</span>

<span class="s2">            fes (Fes): The Fes object to find the minima on.</span>

<span class="s2">            nbins (int, default=8): The number of bins used to divide the FES.</span>

<span class="s2">        &quot;&quot;&quot;</span>

        <span class="s s-Atom">cv_min</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span>

        <span class="s s-Atom">cv_max</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span>

        <span class="s s-Atom">if</span> <span class="nf">int</span><span class="p">(</span><span class="s s-Atom">nbins</span><span class="p">)</span> <span class="p">!</span><span class="o">=</span> <span class="s s-Atom">nbins</span><span class="p">:</span>

            <span class="s s-Atom">nbins</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="s s-Atom">nbins</span><span class="p">)</span>

            <span class="nf">print</span><span class="p">(</span>

                <span class="s s-Atom">f</span><span class="s2">&quot;Number of bins must be an integer, it will be set to {nbins}.&quot;</span><span class="p">)</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span> <span class="c1">% nbins != 0:</span>

            <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;Error: Resolution of FES must be divisible by number of bins.&quot;</span><span class="p">)</span>

            <span class="s s-Atom">return</span> <span class="nv">None</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">nbins</span> <span class="o">&gt;</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="o">/</span><span class="mi">2</span><span class="o">:</span>

            <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;Error: Number of bins is too high.&quot;</span><span class="p">)</span>

            <span class="s s-Atom">return</span> <span class="nv">None</span>

        <span class="s s-Atom">bin_size</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="o">/</span><span class="s s-Atom">nbins</span><span class="p">)</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="nv">None</span>

        <span class="s s-Atom">for</span> <span class="s s-Atom">index</span> <span class="s s-Atom">in</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">ndindex</span><span class="p">(</span><span class="nf">tuple</span><span class="p">([</span><span class="s s-Atom">nbins</span><span class="p">]</span> <span class="o">*</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">))</span><span class="o">:</span>

            <span class="s s-Atom">#</span> <span class="s s-Atom">index</span> <span class="s s-Atom">serve</span> <span class="s s-Atom">as</span> <span class="s s-Atom">bin</span> <span class="s s-Atom">number</span>

            <span class="k">_</span><span class="s s-Atom">fes_slice</span> <span class="o">=</span> <span class="nf">tuple</span><span class="p">(</span>

                <span class="nf">slice</span><span class="p">(</span>

                    <span class="s s-Atom">index</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">]</span> <span class="o">*</span> <span class="s s-Atom">bin_size</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">index</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="s s-Atom">bin_size</span>

                <span class="p">)</span> <span class="s s-Atom">for</span> <span class="s s-Atom">i</span> <span class="s s-Atom">in</span> <span class="nf">range</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">)</span>

            <span class="p">)</span>

            <span class="s s-Atom">fes_slice</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">[</span><span class="k">_</span><span class="s s-Atom">fes_slice</span><span class="p">]</span>

            <span class="s s-Atom">bin_min</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="s s-Atom">fes_slice</span><span class="p">)</span>

            <span class="s s-Atom">#</span> <span class="s s-Atom">indexes</span> <span class="s s-Atom">of</span> <span class="s s-Atom">global</span> <span class="s s-Atom">minimum</span> <span class="s s-Atom">of</span> <span class="s s-Atom">a</span> <span class="s s-Atom">bin</span>

            <span class="s s-Atom">bin_min_arg</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">unravel_index</span><span class="p">(</span>

                <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">argmin</span><span class="p">(</span><span class="s s-Atom">fes_slice</span><span class="p">),</span> <span class="s s-Atom">fes_slice</span><span class="p">.</span><span class="s s-Atom">shape</span>

            <span class="p">)</span>

            <span class="s s-Atom">#</span> <span class="s s-Atom">indexes</span> <span class="s s-Atom">of</span> <span class="s s-Atom">that</span> <span class="s s-Atom">minima</span> <span class="s s-Atom">in</span> <span class="s s-Atom">the</span> <span class="s s-Atom">original</span> <span class="nf">fes</span> <span class="p">(</span><span class="s s-Atom">indexes</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span>

            <span class="s s-Atom">min_cv_b</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span>

                <span class="s s-Atom">bin_min_arg</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">]</span> <span class="o">+</span> <span class="s s-Atom">index</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">]</span> <span class="o">*</span> <span class="s s-Atom">bin_size</span> <span class="s s-Atom">for</span> <span class="s s-Atom">i</span> <span class="s s-Atom">in</span> <span class="nf">range</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">)</span>

            <span class="p">],</span> <span class="s s-Atom">dtype</span><span class="o">=</span><span class="s s-Atom">int</span><span class="p">)</span>

            <span class="nf">if</span> <span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="s s-Atom">bin_min_arg</span><span class="p">,</span> <span class="s s-Atom">dtype</span><span class="o">=</span><span class="s s-Atom">int</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">).</span><span class="nf">all</span><span class="p">()</span> <span class="s s-Atom">and</span> <span class="s s-Atom">\</span>

                    <span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="s s-Atom">bin_min_arg</span><span class="p">,</span> <span class="s s-Atom">dtype</span><span class="o">=</span><span class="s s-Atom">int</span><span class="p">)</span> <span class="o">&lt;</span> <span class="s s-Atom">bin_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">).</span><span class="nf">all</span><span class="p">()</span><span class="o">:</span>

                <span class="s s-Atom">#</span> <span class="s s-Atom">if</span> <span class="s s-Atom">the</span> <span class="s s-Atom">minima</span> <span class="o">is</span> <span class="o">not</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="s s-Atom">edge</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">bin</span>

                <span class="s s-Atom">min_cv</span> <span class="o">=</span> <span class="p">(((</span><span class="s s-Atom">min_cv_b</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="s s-Atom">cv_max</span><span class="o">-</span><span class="s s-Atom">cv_min</span><span class="p">))</span><span class="o">+</span><span class="s s-Atom">cv_min</span>

                <span class="s s-Atom">local_minima</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">([</span>

                    <span class="p">[</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="s s-Atom">bin_min</span><span class="p">,</span> <span class="mi">6</span><span class="p">)],</span> <span class="s s-Atom">min_cv_b</span><span class="p">,</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="s s-Atom">min_cv</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

                <span class="p">])</span>

                <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">is</span> <span class="nv">None</span><span class="o">:</span>

                    <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">local_minima</span>

                <span class="s s-Atom">else</span><span class="p">:</span>

                    <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">vstack</span><span class="p">((</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">,</span> <span class="s s-Atom">local_minima</span><span class="p">))</span>

            <span class="s s-Atom">else</span><span class="p">:</span>

                <span class="s s-Atom">#</span> <span class="s s-Atom">if</span> <span class="s s-Atom">the</span> <span class="s s-Atom">minima</span> <span class="o">is</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="s s-Atom">edge</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">bin</span>

                <span class="s s-Atom">around</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="nf">tuple</span><span class="p">([</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">))</span>

                <span class="s s-Atom">for</span> <span class="s s-Atom">product_index</span> <span class="s s-Atom">in</span> <span class="nf">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span> <span class="o">*</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">)</span><span class="o">:</span>

                    <span class="s s-Atom">converted_index</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="s s-Atom">product_index</span><span class="p">,</span> <span class="s s-Atom">dtype</span><span class="o">=</span><span class="s s-Atom">int</span><span class="p">)</span> <span class="o">+</span> <span class="s s-Atom">\</span>

                        <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="s s-Atom">min_cv_b</span><span class="p">,</span> <span class="s s-Atom">dtype</span><span class="o">=</span><span class="s s-Atom">int</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

                    <span class="s s-Atom">converted_index</span><span class="p">[</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">periodic</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">\</span>

                        <span class="s s-Atom">converted_index</span><span class="p">[</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">periodic</span><span class="p">]</span> <span class="c1">% self.res</span>

                    <span class="s s-Atom">mask</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span>

                        <span class="p">(</span><span class="s s-Atom">converted_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s s-Atom">converted_index</span> <span class="o">&gt;</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="s s-Atom">if</span> <span class="nf">len</span><span class="p">(</span><span class="s s-Atom">mask</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">:</span>

                        <span class="s s-Atom">around</span><span class="p">[</span><span class="s s-Atom">product_index</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="s s-Atom">inf</span>

                    <span class="s s-Atom">elif</span> <span class="s s-Atom">product_index</span> <span class="o">==</span> <span class="nf">tuple</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">)</span><span class="o">:</span>

                        <span class="s s-Atom">around</span><span class="p">[</span><span class="s s-Atom">product_index</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="s s-Atom">inf</span>

                    <span class="s s-Atom">else</span><span class="p">:</span>

                        <span class="s s-Atom">around</span><span class="p">[</span><span class="s s-Atom">product_index</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">[</span><span class="nf">tuple</span><span class="p">(</span>

                            <span class="s s-Atom">converted_index</span><span class="p">)]</span>

                <span class="nf">if</span> <span class="p">(</span><span class="s s-Atom">around</span> <span class="o">&gt;</span> <span class="s s-Atom">bin_min</span><span class="p">).</span><span class="nf">all</span><span class="p">()</span><span class="o">:</span>

                    <span class="s s-Atom">min_cv</span> <span class="o">=</span> <span class="p">(((</span><span class="s s-Atom">min_cv_b</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="s s-Atom">cv_max</span><span class="o">-</span><span class="s s-Atom">cv_min</span><span class="p">))</span><span class="o">+</span><span class="s s-Atom">cv_min</span>

                    <span class="s s-Atom">local_minima</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">([</span>

                        <span class="p">[</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="s s-Atom">bin_min</span><span class="p">,</span> <span class="mi">6</span><span class="p">)],</span> <span class="s s-Atom">min_cv_b</span><span class="p">,</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="s s-Atom">min_cv</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

                    <span class="p">])</span>

                    <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">is</span> <span class="nv">None</span><span class="o">:</span>

                        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">local_minima</span>

                    <span class="s s-Atom">else</span><span class="p">:</span>

                        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">vstack</span><span class="p">((</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">,</span> <span class="s s-Atom">local_minima</span><span class="p">))</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">is</span> <span class="nv">None</span><span class="o">:</span>

            <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;No minima found.&quot;</span><span class="p">)</span>

            <span class="s s-Atom">return</span> <span class="nv">None</span>

        <span class="s s-Atom">if</span> <span class="nf">len</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">:</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">[</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">argsort</span><span class="p">()]</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="o">:</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">((</span>

                <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">dtype</span><span class="o">=</span><span class="s s-Atom">int</span><span class="p">),</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span>

            <span class="p">))</span>

        <span class="s s-Atom">else</span><span class="p">:</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">column_stack</span><span class="p">((</span>

                <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">dtype</span><span class="o">=</span><span class="s s-Atom">int</span><span class="p">),</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span>

            <span class="p">))</span>

        <span class="s s-Atom">minima_df</span> <span class="o">=</span> <span class="s s-Atom">pd</span><span class="p">.</span><span class="nv">DataFrame</span><span class="p">(</span>

            <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">),</span>

            <span class="s s-Atom">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Minimum&quot;</span><span class="p">,</span> <span class="s2">&quot;free energy&quot;</span><span class="p">]</span> <span class="o">+</span>

            <span class="p">[</span><span class="s s-Atom">f</span><span class="s2">&quot;CV{i+1}bin&quot;</span> <span class="s s-Atom">for</span> <span class="s s-Atom">i</span> <span class="s s-Atom">in</span> <span class="nf">range</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">)]</span> <span class="o">+</span>

            <span class="p">[</span><span class="s s-Atom">f</span><span class="s2">&quot;CV{i+1} - {self.cv_name[i]}&quot;</span> <span class="s s-Atom">for</span> <span class="s s-Atom">i</span> <span class="s s-Atom">in</span> <span class="nf">range</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">)]</span>

        <span class="p">)</span>

        <span class="s s-Atom">minima_df</span><span class="p">[</span><span class="s2">&quot;Minimum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">minima_df</span><span class="p">[</span><span class="s2">&quot;Minimum&quot;</span><span class="p">].</span><span class="nf">astype</span><span class="p">(</span><span class="s s-Atom">int</span><span class="p">)</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">minima_df</span>

    <span class="s s-Atom">def</span> <span class="nf">plot</span><span class="p">(</span>

        <span class="s s-Atom">self</span><span class="p">,</span>

        <span class="s s-Atom">png_name</span><span class="o">:</span> <span class="nv">Optional</span><span class="p">[</span><span class="s s-Atom">str</span><span class="p">]</span> <span class="o">=</span> <span class="nv">None</span><span class="p">,</span>

        <span class="s s-Atom">contours</span><span class="p">:</span> <span class="s s-Atom">bool</span> <span class="o">=</span> <span class="nv">True</span><span class="p">,</span>

        <span class="s s-Atom">contours_spacing</span><span class="o">:</span> <span class="s s-Atom">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>

        <span class="s s-Atom">aspect</span><span class="p">:</span> <span class="s s-Atom">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>

        <span class="s s-Atom">cmap</span><span class="p">:</span> <span class="s s-Atom">str</span> <span class="o">=</span> <span class="s2">&quot;jet&quot;</span><span class="p">,</span>

        <span class="s s-Atom">energy_unit</span><span class="o">:</span> <span class="s s-Atom">str</span> <span class="o">=</span> <span class="s2">&quot;kJ/mol&quot;</span><span class="p">,</span>

        <span class="s s-Atom">xlabel</span><span class="p">:</span> <span class="nv">Optional</span><span class="p">[</span><span class="s s-Atom">str</span><span class="p">]</span> <span class="o">=</span> <span class="nv">None</span><span class="p">,</span>

        <span class="s s-Atom">ylabel</span><span class="p">:</span> <span class="nv">Optional</span><span class="p">[</span><span class="s s-Atom">str</span><span class="p">]</span> <span class="o">=</span> <span class="nv">None</span><span class="p">,</span>

        <span class="s s-Atom">zlabel</span><span class="p">:</span> <span class="nv">Optional</span><span class="p">[</span><span class="s s-Atom">str</span><span class="p">]</span> <span class="o">=</span> <span class="nv">None</span><span class="p">,</span>

        <span class="s s-Atom">label_size</span><span class="o">:</span> <span class="s s-Atom">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>

        <span class="s s-Atom">image_size</span><span class="o">:</span> <span class="nv">List</span><span class="p">[</span><span class="s s-Atom">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>

        <span class="s s-Atom">color</span><span class="p">:</span> <span class="nv">Optional</span><span class="p">[</span><span class="s s-Atom">str</span><span class="p">]</span> <span class="o">=</span> <span class="nv">None</span><span class="p">,</span>

        <span class="s s-Atom">vmin</span><span class="p">:</span> <span class="s s-Atom">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

        <span class="s s-Atom">vmax</span><span class="p">:</span> <span class="nv">Optional</span><span class="p">[</span><span class="s s-Atom">float</span><span class="p">]</span> <span class="o">=</span> <span class="nv">None</span><span class="p">,</span>

        <span class="s s-Atom">opacity</span><span class="p">:</span> <span class="s s-Atom">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>

        <span class="s s-Atom">levels</span><span class="p">:</span> <span class="nv">Optional</span><span class="p">[</span><span class="nv">List</span><span class="p">[</span><span class="s s-Atom">float</span><span class="p">]]</span> <span class="o">=</span> <span class="nv">None</span><span class="p">,</span>

        <span class="s s-Atom">show_points</span><span class="o">:</span> <span class="s s-Atom">bool</span> <span class="o">=</span> <span class="nv">True</span><span class="p">,</span>

        <span class="s s-Atom">point_size</span><span class="o">:</span> <span class="s s-Atom">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>

    <span class="p">)</span><span class="o">:</span>

        <span class="s2">&quot;&quot;</span><span class="err">&quot;</span>

        <span class="nv">Function</span> <span class="s s-Atom">used</span> <span class="s s-Atom">to</span> <span class="s s-Atom">visualize</span> <span class="s s-Atom">the</span> <span class="nv">FES</span> <span class="s s-Atom">objects</span> <span class="s s-Atom">with</span> <span class="s s-Atom">the</span> <span class="s s-Atom">positions</span> <span class="s s-Atom">of</span> <span class="s s-Atom">local</span> <span class="s s-Atom">minima</span> <span class="s s-Atom">shown</span> <span class="s s-Atom">as</span> <span class="s s-Atom">letters</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="s s-Atom">graph</span><span class="p">.</span>

        <span class="nv">Usage</span><span class="o">:</span>

        <span class="err">```</span><span class="s s-Atom">python</span>

        <span class="s s-Atom">minima</span><span class="p">.</span><span class="nf">plot</span><span class="p">()</span>

        <span class="err">```</span>

        <span class="nv">Args</span><span class="o">:</span>

            <span class="nf">png_name</span> <span class="p">(</span><span class="s s-Atom">str</span><span class="p">,</span> <span class="s s-Atom">optional</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">If</span> <span class="s s-Atom">provided</span><span class="p">,</span> <span class="s s-Atom">the</span> <span class="s s-Atom">picture</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="nv">FES</span> <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">saved</span> <span class="s s-Atom">under</span> <span class="s s-Atom">this</span> <span class="s s-Atom">name</span> <span class="s s-Atom">to</span> <span class="s s-Atom">the</span> <span class="s s-Atom">current</span> <span class="s s-Atom">working</span> <span class="s s-Atom">directory</span><span class="p">.</span>

            <span class="nf">contours</span> <span class="p">(</span><span class="s s-Atom">bool</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">Specifies</span> <span class="s s-Atom">whether</span> <span class="s s-Atom">contours</span> <span class="s s-Atom">should</span> <span class="s s-Atom">be</span> <span class="s s-Atom">shown</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="mi">2</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span>

            <span class="nf">contours_spacing</span> <span class="p">(</span><span class="s s-Atom">float</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">When</span> <span class="s s-Atom">a</span> <span class="s s-Atom">positive</span> <span class="s s-Atom">number</span> <span class="o">is</span> <span class="s s-Atom">set</span><span class="p">,</span> <span class="s s-Atom">it</span> <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">used</span> <span class="s s-Atom">as</span> <span class="s s-Atom">the</span> <span class="s s-Atom">spacing</span> <span class="s s-Atom">for</span> <span class="s s-Atom">contours</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="mi">2</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span> <span class="s s-Atom">\</span>

                <span class="nv">Otherwise</span><span class="p">,</span> <span class="s s-Atom">if</span> <span class="s s-Atom">contours</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span> <span class="s s-Atom">there</span> <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">five</span> <span class="s s-Atom">equally</span> <span class="s s-Atom">spaced</span> <span class="s s-Atom">contour</span> <span class="s s-Atom">levels</span><span class="p">.</span>

            <span class="nf">aspect</span> <span class="p">(</span><span class="s s-Atom">float</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">The</span> <span class="s s-Atom">aspect</span> <span class="s s-Atom">ratio</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">graph</span><span class="p">.</span> <span class="nv">Works</span> <span class="s s-Atom">with</span> <span class="mi">1</span><span class="nv">D</span> <span class="s s-Atom">and</span> <span class="mi">2</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span>

            <span class="nf">cmap</span> <span class="p">(</span><span class="s s-Atom">str</span><span class="p">,</span> <span class="s s-Atom">default=</span><span class="s2">&quot;jet&quot;</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">The</span> <span class="nv">Matplotlib</span> <span class="s s-Atom">colormap</span> <span class="s s-Atom">used</span> <span class="s s-Atom">to</span> <span class="s s-Atom">color</span> <span class="s s-Atom">the</span> <span class="mi">2</span><span class="nv">D</span> <span class="s s-Atom">or</span> <span class="mi">3</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span>

            <span class="nf">energy_unit</span> <span class="p">(</span><span class="s s-Atom">str</span><span class="p">,</span> <span class="s s-Atom">default=</span><span class="s2">&quot;kJ/mol&quot;</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">A</span> <span class="s s-Atom">string</span> <span class="s s-Atom">used</span> <span class="s s-Atom">in</span> <span class="s s-Atom">the</span> <span class="s s-Atom">description</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">colorbar</span><span class="p">.</span>

            <span class="s s-Atom">xlabel</span><span class="p">,</span> <span class="s s-Atom">ylabel</span><span class="p">,</span> <span class="nf">zlabel</span> <span class="p">(</span><span class="s s-Atom">str</span><span class="p">,</span> <span class="s s-Atom">optional</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">If</span> <span class="s s-Atom">provided</span><span class="p">,</span> <span class="s s-Atom">they</span> <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">used</span> <span class="s s-Atom">as</span> <span class="s s-Atom">labels</span> <span class="s s-Atom">for</span> <span class="s s-Atom">the</span> <span class="s s-Atom">graphs</span><span class="p">.</span>

            <span class="nf">label_size</span> <span class="p">(</span><span class="s s-Atom">int</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">:</span> <span class="nv">The</span> <span class="s s-Atom">size</span> <span class="s s-Atom">of</span> <span class="s s-Atom">text</span> <span class="s s-Atom">in</span> <span class="s s-Atom">labels</span><span class="p">.</span>

            <span class="nf">image_size</span> <span class="p">(</span><span class="nv">List</span><span class="p">[</span><span class="s s-Atom">int</span><span class="p">],</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span><span class="o">:</span> <span class="nv">The</span> <span class="s s-Atom">width</span> <span class="s s-Atom">and</span> <span class="s s-Atom">height</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">picture</span><span class="p">.</span>

            <span class="nf">color</span> <span class="p">(</span><span class="s s-Atom">str</span><span class="p">,</span> <span class="s s-Atom">optional</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">The</span> <span class="s s-Atom">name</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">color</span> <span class="s s-Atom">in</span> <span class="nv">Matplotlib</span><span class="p">.</span> <span class="s s-Atom">\</span>

                <span class="nv">If</span> <span class="s s-Atom">set</span><span class="p">,</span> <span class="s s-Atom">the</span> <span class="s s-Atom">color</span> <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">used</span> <span class="s s-Atom">for</span> <span class="s s-Atom">the</span> <span class="s s-Atom">letters</span><span class="p">.</span> <span class="s s-Atom">\</span>

                <span class="nv">If</span> <span class="o">not</span> <span class="s s-Atom">set</span><span class="p">,</span> <span class="s s-Atom">the</span> <span class="s s-Atom">color</span> <span class="s s-Atom">should</span> <span class="s s-Atom">be</span> <span class="s s-Atom">automatically</span> <span class="s s-Atom">either</span> <span class="s s-Atom">black</span> <span class="s s-Atom">or</span> <span class="s s-Atom">white</span><span class="p">,</span> <span class="s s-Atom">\</span>

                <span class="s s-Atom">depending</span> <span class="s s-Atom">on</span> <span class="s s-Atom">what</span> <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">more</span> <span class="s s-Atom">visible</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="s s-Atom">given</span> <span class="s s-Atom">place</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="nv">FES</span> <span class="s s-Atom">with</span> <span class="s s-Atom">the</span> <span class="s s-Atom">given</span> <span class="nf">colormap</span> <span class="p">(</span><span class="s s-Atom">for</span> <span class="mi">2</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">).</span>

            <span class="nf">vmin</span> <span class="p">(</span><span class="s s-Atom">float</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">:</span> <span class="nv">The</span> <span class="s s-Atom">lower</span> <span class="s s-Atom">bound</span> <span class="s s-Atom">for</span> <span class="s s-Atom">the</span> <span class="s s-Atom">colormap</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="mi">2</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span>

            <span class="nf">vmax</span> <span class="p">(</span><span class="s s-Atom">float</span><span class="p">,</span> <span class="s s-Atom">optional</span><span class="p">)</span><span class="o">:</span> <span class="nv">The</span> <span class="s s-Atom">upper</span> <span class="s s-Atom">bound</span> <span class="s s-Atom">for</span> <span class="s s-Atom">the</span> <span class="s s-Atom">colormap</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="mi">2</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span>

            <span class="nf">opacity</span> <span class="p">(</span><span class="s s-Atom">float</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">A</span> <span class="s s-Atom">number</span> <span class="s s-Atom">between</span> <span class="mi">0</span> <span class="s s-Atom">and</span> <span class="mi">1</span> <span class="s s-Atom">representing</span> <span class="s s-Atom">the</span> <span class="s s-Atom">opacity</span> <span class="s s-Atom">of</span> <span class="s s-Atom">isosurfaces</span> <span class="s s-Atom">in</span> <span class="s s-Atom">the</span> <span class="mi">3</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span>

            <span class="nf">levels</span> <span class="p">(</span><span class="nv">List</span><span class="p">[</span><span class="s s-Atom">float</span><span class="p">],</span> <span class="s s-Atom">optional</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">A</span> <span class="s s-Atom">list</span> <span class="s s-Atom">of</span> <span class="s s-Atom">free</span> <span class="s s-Atom">energy</span> <span class="nb">val</span><span class="s s-Atom">ues</span> <span class="s s-Atom">for</span> <span class="s s-Atom">isosurfaces</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="mi">3</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span> <span class="s s-Atom">\</span>

                <span class="nv">If</span> <span class="o">not</span> <span class="s s-Atom">provided</span><span class="p">,</span> <span class="s s-Atom">default</span> <span class="nb">val</span><span class="s s-Atom">ues</span> <span class="s s-Atom">from</span> <span class="s s-Atom">the</span> <span class="s s-Atom">contours</span> <span class="s s-Atom">parameters</span> <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">used</span> <span class="s s-Atom">instead</span><span class="p">.</span>

            <span class="nf">show_points</span> <span class="p">(</span><span class="s s-Atom">bool</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">Specifies</span> <span class="s s-Atom">whether</span> <span class="s s-Atom">points</span> <span class="s s-Atom">should</span> <span class="s s-Atom">be</span> <span class="s s-Atom">visualized</span> <span class="s s-Atom">instead</span> <span class="s s-Atom">of</span> <span class="s s-Atom">just</span> <span class="s s-Atom">the</span> <span class="s s-Atom">letters</span><span class="p">.</span> <span class="s s-Atom">\</span>

                <span class="nv">Only</span> <span class="s s-Atom">applicable</span> <span class="s s-Atom">for</span> <span class="mi">3</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span>

            <span class="nf">point_size</span> <span class="p">(</span><span class="s s-Atom">float</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">The</span> <span class="s s-Atom">size</span> <span class="s s-Atom">of</span> <span class="s s-Atom">points</span> <span class="s s-Atom">if</span> <span class="s s-Atom">show_points</span><span class="o">=</span><span class="nv">True</span><span class="p">.</span>

        <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        import matplotlib.pyplot as plt</span>

<span class="s2">        import matplotlib.cm as cm</span>

<span class="s2">        if vmax == None:</span>

<span class="s2">            # if the addition is smaller than 0.01, the 3d plot stops working.</span>

<span class="s2">            vmax = np.max(self.fes) + 0.01</span>

<span class="s2">        if contours_spacing == 0.0:</span>

<span class="s2">            contours_spacing = (vmax-vmin)/5.0</span>

<span class="s2">        color_map = cm.get_cmap(cmap)</span>

<span class="s2">        color_map.set_over(&quot;</span><span class="s s-Atom">white</span><span class="s2">&quot;)</span>

<span class="s2">        color_map.set_under(&quot;</span><span class="s s-Atom">white</span><span class="s2">&quot;)</span>

<span class="s2">        color_set = True</span>

<span class="s2">        if color == None:</span>

<span class="s2">            color_set = False</span>

<span class="s2">        if self.cvs == 1:</span>

<span class="s2">            cv1min = self.cv_min[0]</span>

<span class="s2">            cv1max = self.cv_max[0]</span>

<span class="s2">            plt.figure(figsize=(image_size[0], image_size[1]))</span>

<span class="s2">            X = np.linspace(cv1min, cv1max, self.res)</span>

<span class="s2">            plt.plot(X, self.fes)</span>

<span class="s2">            if not color_set:</span>

<span class="s2">                color = &quot;</span><span class="s s-Atom">black</span><span class="err">&quot;</span>

            <span class="s s-Atom">ferange</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">)</span> <span class="o">-</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="o">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">text</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s s-Atom">ferange</span><span class="o">*</span><span class="mf">0.05</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

                         <span class="s s-Atom">fontsize</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">,</span> <span class="s s-Atom">horizontalalignment=&#39;center&#39;</span><span class="p">,</span>

                         <span class="s s-Atom">verticalalignment=&#39;bottom&#39;</span><span class="p">,</span> <span class="s s-Atom">c</span><span class="o">=</span><span class="s s-Atom">color</span><span class="p">)</span>

            <span class="s s-Atom">elif</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">:</span>

                <span class="s s-Atom">for</span> <span class="s s-Atom">m</span> <span class="s s-Atom">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span><span class="o">:</span>

                    <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">text</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="s s-Atom">m</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="s s-Atom">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s s-Atom">ferange</span><span class="o">*</span><span class="mf">0.05</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="s s-Atom">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

                             <span class="s s-Atom">fontsize</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">,</span> <span class="s s-Atom">horizontalalignment=&#39;center&#39;</span><span class="p">,</span>

                             <span class="s s-Atom">verticalalignment=&#39;bottom&#39;</span><span class="p">,</span> <span class="s s-Atom">c</span><span class="o">=</span><span class="s s-Atom">color</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">xlabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="s s-Atom">f&#39;CV1 - {self.cv_name[0]}&#39;</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

            <span class="s s-Atom">else</span><span class="p">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="s s-Atom">xlabel</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">ylabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="s s-Atom">f&#39;free energy ({energy_unit})&#39;</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

            <span class="s s-Atom">else</span><span class="p">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="s s-Atom">ylabel</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

        <span class="s s-Atom">elif</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span> <span class="o">==</span> <span class="mi">2</span><span class="o">:</span>

            <span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv2min</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="s s-Atom">cv1max</span><span class="p">,</span> <span class="s s-Atom">cv2max</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="s s-Atom">fig</span> <span class="o">=</span> <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="s s-Atom">figsize=</span><span class="p">(</span><span class="s s-Atom">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">rot90</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">,</span> <span class="s s-Atom">axes=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="s s-Atom">cmap</span><span class="o">=</span><span class="s s-Atom">color_map</span><span class="p">,</span> <span class="s s-Atom">interpolation=&#39;nearest&#39;</span><span class="p">,</span>

                       <span class="s s-Atom">extent</span><span class="o">=</span><span class="p">[</span><span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv1max</span><span class="p">,</span> <span class="s s-Atom">cv2min</span><span class="p">,</span> <span class="s s-Atom">cv2max</span><span class="p">],</span>

                       <span class="s s-Atom">aspect=</span><span class="p">(((</span><span class="s s-Atom">cv1max</span><span class="o">-</span><span class="s s-Atom">cv1min</span><span class="p">)</span><span class="s s-Atom">/</span><span class="p">(</span><span class="s s-Atom">cv2max</span><span class="o">-</span><span class="s s-Atom">cv2min</span><span class="p">))</span><span class="s s-Atom">/</span><span class="p">(</span><span class="s s-Atom">aspect</span><span class="p">)),</span>

                       <span class="s s-Atom">vmin</span><span class="o">=</span><span class="s s-Atom">vmin</span><span class="p">,</span> <span class="s s-Atom">vmax</span><span class="o">=</span><span class="s s-Atom">vmax</span><span class="p">)</span>

            <span class="s s-Atom">cbar</span> <span class="o">=</span> <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">colorbar</span><span class="p">()</span>

            <span class="s s-Atom">cbar</span><span class="p">.</span><span class="nf">set_label</span><span class="p">(</span><span class="s s-Atom">energy_unit</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="o">:</span>

                <span class="s s-Atom">background</span> <span class="o">=</span> <span class="nf">color_map</span><span class="p">(</span>

                    <span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="s s-Atom">vmin</span><span class="p">)</span><span class="s s-Atom">/</span><span class="p">(</span><span class="s s-Atom">vmax</span><span class="o">-</span><span class="s s-Atom">vmin</span><span class="p">))</span>

                <span class="s s-Atom">luma</span> <span class="o">=</span> <span class="s s-Atom">background</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">0.2126</span><span class="o">+</span><span class="s s-Atom">background</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="s s-Atom">\</span>

                    <span class="mf">0.7152</span><span class="o">+</span><span class="s s-Atom">background</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mf">0.0722</span>

                <span class="s s-Atom">if</span> <span class="s s-Atom">luma</span> <span class="o">&gt;</span> <span class="mf">0.6</span> <span class="s s-Atom">and</span> <span class="o">not</span> <span class="s s-Atom">color_set</span><span class="o">:</span>

                    <span class="s s-Atom">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>

                <span class="s s-Atom">elif</span> <span class="s s-Atom">luma</span> <span class="s s-Atom">&lt;=</span> <span class="mf">0.6</span> <span class="s s-Atom">and</span> <span class="o">not</span> <span class="s s-Atom">color_set</span><span class="o">:</span>

                    <span class="s s-Atom">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">text</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

                         <span class="s s-Atom">fontsize</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">,</span> <span class="s s-Atom">horizontalalignment=&#39;center&#39;</span><span class="p">,</span>

                         <span class="s s-Atom">verticalalignment=&#39;center&#39;</span><span class="p">,</span> <span class="s s-Atom">c</span><span class="o">=</span><span class="s s-Atom">color</span><span class="p">)</span>

            <span class="s s-Atom">elif</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">:</span>

                <span class="s s-Atom">for</span> <span class="s s-Atom">m</span> <span class="s s-Atom">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span><span class="o">:</span>

                    <span class="s s-Atom">background</span> <span class="o">=</span> <span class="nf">color_map</span><span class="p">(</span>

                        <span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="s s-Atom">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="s s-Atom">vmin</span><span class="p">)</span><span class="s s-Atom">/</span><span class="p">(</span><span class="s s-Atom">vmax</span><span class="o">-</span><span class="s s-Atom">vmin</span><span class="p">))</span>

                    <span class="s s-Atom">luma</span> <span class="o">=</span> <span class="s s-Atom">background</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">0.2126</span> <span class="o">+</span> <span class="s s-Atom">\</span>

                        <span class="s s-Atom">background</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">0.7152</span><span class="o">+</span><span class="s s-Atom">background</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mf">0.0722</span>

                    <span class="s s-Atom">if</span> <span class="s s-Atom">luma</span> <span class="o">&gt;</span> <span class="mf">0.6</span> <span class="s s-Atom">and</span> <span class="o">not</span> <span class="s s-Atom">color_set</span><span class="o">:</span>

                        <span class="s s-Atom">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>

                    <span class="s s-Atom">elif</span> <span class="s s-Atom">luma</span> <span class="s s-Atom">&lt;=</span> <span class="mf">0.6</span> <span class="s s-Atom">and</span> <span class="o">not</span> <span class="s s-Atom">color_set</span><span class="o">:</span>

                        <span class="s s-Atom">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>

                    <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">text</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="s s-Atom">m</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="s s-Atom">m</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="s s-Atom">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

                             <span class="s s-Atom">fontsize</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">,</span> <span class="s s-Atom">horizontalalignment=&#39;center&#39;</span><span class="p">,</span>

                             <span class="s s-Atom">verticalalignment=&#39;center&#39;</span><span class="p">,</span> <span class="s s-Atom">c</span><span class="o">=</span><span class="s s-Atom">color</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">contours</span><span class="p">:</span>

                <span class="s s-Atom">cont</span> <span class="o">=</span> <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">contour</span><span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">rot90</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">,</span> <span class="s s-Atom">axes=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>

                                   <span class="s s-Atom">levels</span><span class="o">=</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span>

                                       <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">vmax</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">),</span> <span class="s s-Atom">contours_spacing</span><span class="p">),</span>

                                   <span class="s s-Atom">extent</span><span class="o">=</span><span class="p">[</span><span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv1max</span><span class="p">,</span> <span class="s s-Atom">cv2max</span><span class="p">,</span> <span class="s s-Atom">cv2min</span><span class="p">],</span>

                                   <span class="s s-Atom">colors=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">clabel</span><span class="p">(</span><span class="s s-Atom">cont</span><span class="p">,</span> <span class="s s-Atom">levels</span><span class="o">=</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span>

                    <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">vmax</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">),</span> <span class="s s-Atom">contours_spacing</span><span class="p">))</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">xlabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="s s-Atom">f&#39;CV1 - {self.cv_name[0]}&#39;</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

            <span class="s s-Atom">else</span><span class="p">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="s s-Atom">xlabel</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">ylabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="s s-Atom">f&#39;CV2 - {self.cv_name[1]}&#39;</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

            <span class="s s-Atom">else</span><span class="p">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="s s-Atom">ylabel</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

        <span class="s s-Atom">elif</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span> <span class="o">==</span> <span class="mi">3</span><span class="o">:</span>

            <span class="s s-Atom">try</span><span class="p">:</span>

                <span class="s s-Atom">import</span> <span class="s s-Atom">pyvista</span> <span class="s s-Atom">as</span> <span class="s s-Atom">pv</span>

            <span class="nf">except</span> <span class="p">(</span><span class="nv">ImportError</span><span class="p">,</span> <span class="nv">ModuleNotFoundError</span><span class="p">)</span> <span class="s s-Atom">as</span> <span class="s s-Atom">e</span><span class="p">:</span>

                <span class="nf">print</span><span class="p">(</span><span class="s s-Atom">e</span><span class="p">)</span>

                <span class="s s-Atom">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv2min</span><span class="p">,</span> <span class="s s-Atom">cv3min</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="s s-Atom">cv1max</span><span class="p">,</span> <span class="s s-Atom">cv2max</span><span class="p">,</span> <span class="s s-Atom">cv3max</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">xlabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">xlabel</span> <span class="o">=</span> <span class="s2">&quot;CV1 - &quot;</span> <span class="o">+</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">ylabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">ylabel</span> <span class="o">=</span> <span class="s2">&quot;CV2 - &quot;</span> <span class="o">+</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">zlabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">zlabel</span> <span class="o">=</span> <span class="s2">&quot;CV3 - &quot;</span> <span class="o">+</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="s s-Atom">min_ar</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">5</span><span class="o">:</span><span class="mi">8</span><span class="p">].</span><span class="nb">val</span><span class="s s-Atom">ues</span>

            <span class="s s-Atom">min_ar</span> <span class="o">=</span> <span class="s s-Atom">min_ar</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="s s-Atom">float32</span><span class="p">)</span>

            <span class="s s-Atom">min_pv</span> <span class="o">=</span> <span class="s s-Atom">pv</span><span class="p">.</span><span class="nv">PolyData</span><span class="p">(</span><span class="s s-Atom">min_ar</span><span class="p">)</span>

            <span class="s s-Atom">grid</span> <span class="o">=</span> <span class="s s-Atom">pv</span><span class="p">.</span><span class="nv">UniformGrid</span><span class="p">(</span>

                <span class="s s-Atom">dimensions=</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">),</span>

                <span class="s s-Atom">spacing=</span><span class="p">((</span><span class="s s-Atom">cv1max</span><span class="o">-</span><span class="s s-Atom">cv1min</span><span class="p">)</span><span class="o">/</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">cv2max</span><span class="o">-</span><span class="s s-Atom">cv2min</span><span class="p">)</span> <span class="o">/</span>

                         <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">cv3max</span><span class="o">-</span><span class="s s-Atom">cv3min</span><span class="p">)</span><span class="o">/</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">),</span>

                <span class="s s-Atom">origin=</span><span class="p">(</span><span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv2min</span><span class="p">,</span> <span class="s s-Atom">cv3min</span><span class="p">)</span>

            <span class="p">)</span>

            <span class="s s-Atom">grid</span><span class="p">[</span><span class="s2">&quot;vol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">.</span><span class="nf">ravel</span><span class="p">(</span><span class="s s-Atom">order=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">levels</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">contours</span> <span class="o">=</span> <span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">contour</span><span class="p">(</span>

                    <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">vmax</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">),</span> <span class="s s-Atom">contours_spacing</span><span class="p">))</span>

            <span class="s s-Atom">else</span><span class="p">:</span>

                <span class="s s-Atom">contours</span> <span class="o">=</span> <span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">contour</span><span class="p">(</span><span class="s s-Atom">levels</span><span class="p">)</span>

            <span class="s s-Atom">fescolors</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="s s-Atom">for</span> <span class="s s-Atom">i</span> <span class="s s-Atom">in</span> <span class="nf">range</span><span class="p">(</span><span class="s s-Atom">contours</span><span class="p">.</span><span class="s s-Atom">points</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">:</span>

                <span class="s s-Atom">fescolors</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">[</span><span class="nf">int</span><span class="p">((</span><span class="s s-Atom">contours</span><span class="p">.</span><span class="s s-Atom">points</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="s s-Atom">cv1min</span><span class="p">)</span><span class="o">*</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res/</span><span class="p">(</span><span class="s s-Atom">cv1max</span><span class="o">-</span><span class="s s-Atom">cv1min</span><span class="p">)),</span>

                                          <span class="nf">int</span><span class="p">((</span>

                                              <span class="s s-Atom">contours</span><span class="p">.</span><span class="s s-Atom">points</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="s s-Atom">cv2min</span><span class="p">)</span><span class="o">*</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res/</span><span class="p">(</span><span class="s s-Atom">cv2max</span><span class="o">-</span><span class="s s-Atom">cv2min</span><span class="p">)),</span>

                                          <span class="nf">int</span><span class="p">((</span><span class="s s-Atom">contours</span><span class="p">.</span><span class="s s-Atom">points</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="s s-Atom">cv3min</span><span class="p">)</span><span class="o">*</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res/</span><span class="p">(</span><span class="s s-Atom">cv3max</span><span class="o">-</span><span class="s s-Atom">cv3min</span><span class="p">))])</span>

            <span class="s s-Atom">#</span> <span class="c1">%% Visualization</span>

            <span class="s s-Atom">pv</span><span class="p">.</span><span class="nf">set_plot_theme</span><span class="p">(</span><span class="s s-Atom">&#39;document&#39;</span><span class="p">)</span>

            <span class="s s-Atom">p</span> <span class="o">=</span> <span class="s s-Atom">pv</span><span class="p">.</span><span class="nv">Plotter</span><span class="p">()</span>

            <span class="s s-Atom">p</span><span class="p">.</span><span class="nf">add_mesh</span><span class="p">(</span><span class="s s-Atom">contours</span><span class="p">,</span> <span class="s s-Atom">scalars</span><span class="o">=</span><span class="s s-Atom">fescolors</span><span class="p">,</span> <span class="s s-Atom">opacity</span><span class="o">=</span><span class="s s-Atom">opacity</span><span class="p">,</span>

                       <span class="s s-Atom">cmap</span><span class="o">=</span><span class="s s-Atom">color_map</span><span class="p">,</span> <span class="s s-Atom">show_scalar_bar</span><span class="o">=</span><span class="nv">False</span><span class="p">,</span> <span class="s s-Atom">interpolate_before_map</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span>

            <span class="s s-Atom">p</span><span class="p">.</span><span class="nf">show_grid</span><span class="p">(</span><span class="s s-Atom">xlabel</span><span class="o">=</span><span class="s s-Atom">xlabel</span><span class="p">,</span> <span class="s s-Atom">ylabel</span><span class="o">=</span><span class="s s-Atom">ylabel</span><span class="p">,</span> <span class="s s-Atom">zlabel</span><span class="o">=</span><span class="s s-Atom">zlabel</span><span class="p">)</span>

            <span class="s s-Atom">p</span><span class="p">.</span><span class="nf">add_point_labels</span><span class="p">(</span><span class="s s-Atom">min_pv</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

                               <span class="s s-Atom">show_points</span><span class="o">=</span><span class="s s-Atom">show_points</span><span class="p">,</span> <span class="s s-Atom">always_visible</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span>

                               <span class="s s-Atom">point_color=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s s-Atom">point_size</span><span class="o">=</span><span class="s s-Atom">point_size</span><span class="p">,</span>

                               <span class="s s-Atom">font_size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">,</span> <span class="s s-Atom">shape</span><span class="o">=</span><span class="nv">None</span><span class="p">)</span>

            <span class="s s-Atom">p</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">png_name</span> <span class="p">!</span><span class="o">=</span> <span class="nv">None</span><span class="o">:</span>

            <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">savefig</span><span class="p">(</span><span class="s s-Atom">png_name</span><span class="p">)</span>

    <span class="s s-Atom">def</span> <span class="nf">make_gif</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">gif_name=</span><span class="s2">&quot;FES.gif&quot;</span><span class="p">,</span> <span class="s s-Atom">cmap=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span>

                 <span class="s s-Atom">xlabel</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">ylabel</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">zlabel</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">label_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="s s-Atom">image_size</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>

                 <span class="s s-Atom">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="s s-Atom">levels</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">show_points</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span> <span class="s s-Atom">point_size</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="s s-Atom">frames</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span><span class="o">:</span>

        <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        Equvivalent to Fes.make_gif()</span>

<span class="s2">        &quot;&quot;&quot;</span>

        <span class="s s-Atom">try</span><span class="p">:</span>

            <span class="s s-Atom">import</span> <span class="s s-Atom">pyvista</span> <span class="s s-Atom">as</span> <span class="s s-Atom">pv</span>

        <span class="nf">except</span> <span class="p">(</span><span class="nv">ImportError</span><span class="p">,</span> <span class="nv">ModuleNotFoundError</span><span class="p">)</span> <span class="s s-Atom">as</span> <span class="s s-Atom">e</span><span class="p">:</span>

            <span class="nf">print</span><span class="p">(</span><span class="s s-Atom">e</span><span class="p">)</span>

            <span class="s s-Atom">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span> <span class="o">==</span> <span class="mi">3</span><span class="o">:</span>

            <span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv2min</span><span class="p">,</span> <span class="s s-Atom">cv3min</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="s s-Atom">cv1max</span><span class="p">,</span> <span class="s s-Atom">cv2max</span><span class="p">,</span> <span class="s s-Atom">cv3max</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="nb">val</span><span class="s s-Atom">ues</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>

                                 <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">),</span> <span class="s s-Atom">num</span><span class="o">=</span><span class="s s-Atom">frames</span><span class="p">)</span>

            <span class="s s-Atom">grid</span> <span class="o">=</span> <span class="s s-Atom">pv</span><span class="p">.</span><span class="nv">UniformGrid</span><span class="p">(</span>

                <span class="s s-Atom">dimensions=</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">),</span>

                <span class="s s-Atom">spacing=</span><span class="p">((</span><span class="s s-Atom">cv1max</span><span class="o">-</span><span class="s s-Atom">cv1min</span><span class="p">)</span><span class="o">/</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">cv2max</span><span class="o">-</span><span class="s s-Atom">cv2min</span><span class="p">)</span> <span class="o">/</span>

                         <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">cv3max</span><span class="o">-</span><span class="s s-Atom">cv3min</span><span class="p">)</span><span class="o">/</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">),</span>

                <span class="s s-Atom">origin=</span><span class="p">(</span><span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv2min</span><span class="p">,</span> <span class="s s-Atom">cv3min</span><span class="p">),</span>

            <span class="p">)</span>

            <span class="s s-Atom">grid</span><span class="p">[</span><span class="s2">&quot;vol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">.</span><span class="nf">ravel</span><span class="p">(</span><span class="s s-Atom">order=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

            <span class="s s-Atom">surface</span> <span class="o">=</span> <span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">contour</span><span class="p">(</span><span class="nb">val</span><span class="s s-Atom">ues</span><span class="p">[</span><span class="o">:</span><span class="mi">1</span><span class="p">])</span>

            <span class="s s-Atom">surfaces</span> <span class="o">=</span> <span class="p">[</span><span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">contour</span><span class="p">([</span><span class="s s-Atom">v</span><span class="p">])</span> <span class="s s-Atom">for</span> <span class="s s-Atom">v</span> <span class="s s-Atom">in</span> <span class="nb">val</span><span class="s s-Atom">ues</span><span class="p">]</span>

            <span class="s s-Atom">surface</span> <span class="o">=</span> <span class="s s-Atom">surfaces</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">copy</span><span class="p">()</span>

            <span class="s s-Atom">pv</span><span class="p">.</span><span class="nf">set_plot_theme</span><span class="p">(</span><span class="s s-Atom">&#39;document&#39;</span><span class="p">)</span>

            <span class="s s-Atom">plotter</span> <span class="o">=</span> <span class="s s-Atom">pv</span><span class="p">.</span><span class="nv">Plotter</span><span class="p">(</span><span class="s s-Atom">off_screen</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span>

            <span class="s s-Atom">#</span> <span class="nv">Open</span> <span class="s s-Atom">a</span> <span class="s s-Atom">movie</span> <span class="s s-Atom">file</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">open_gif</span><span class="p">(</span><span class="s s-Atom">gif_name</span><span class="p">)</span>

            <span class="s s-Atom">#</span> <span class="nv">Add</span> <span class="s s-Atom">initial</span> <span class="s s-Atom">mesh</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">add_mesh</span><span class="p">(</span>

                <span class="s s-Atom">surface</span><span class="p">,</span>

                <span class="s s-Atom">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>

                <span class="s s-Atom">clim</span><span class="o">=</span><span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">get_data_range</span><span class="p">(),</span>

                <span class="s s-Atom">show_scalar_bar</span><span class="o">=</span><span class="nv">False</span><span class="p">,</span>

                <span class="s s-Atom">cmap=</span><span class="s2">&quot;jet&quot;</span>

            <span class="p">)</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">add_mesh</span><span class="p">(</span><span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">outline_corners</span><span class="p">(),</span> <span class="s s-Atom">color=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">xlabel</span> <span class="o">==</span> <span class="nv">None</span> <span class="s s-Atom">and</span> <span class="s s-Atom">ylabel</span> <span class="o">==</span> <span class="nv">None</span> <span class="s s-Atom">and</span> <span class="s s-Atom">zlabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">show_grid</span><span class="p">(</span>

                    <span class="s s-Atom">xlabel</span><span class="o">=</span><span class="s s-Atom">f</span><span class="s2">&quot;CV1 - {self.cv_name[0]}&quot;</span><span class="p">,</span> <span class="s s-Atom">ylabel</span><span class="o">=</span><span class="s s-Atom">f</span><span class="s2">&quot;CV2 - {self.cv_name[1]}&quot;</span><span class="p">,</span> <span class="s s-Atom">zlabel</span><span class="o">=</span><span class="s s-Atom">f</span><span class="s2">&quot;CV3 - {self.cv_name[2]}&quot;</span><span class="p">)</span>

            <span class="s s-Atom">else</span><span class="p">:</span>

                <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">show_grid</span><span class="p">(</span><span class="s s-Atom">xlabel</span><span class="o">=</span><span class="s s-Atom">xlabel</span><span class="p">,</span> <span class="s s-Atom">ylabel</span><span class="o">=</span><span class="s s-Atom">ylabel</span><span class="p">,</span> <span class="s s-Atom">zlabel</span><span class="o">=</span><span class="s s-Atom">zlabel</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">show_points</span><span class="o">:</span>

                <span class="s s-Atom">min_ar</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">5</span><span class="o">:</span><span class="mi">8</span><span class="p">].</span><span class="nb">val</span><span class="s s-Atom">ues</span>

                <span class="s s-Atom">min_ar</span> <span class="o">=</span> <span class="s s-Atom">min_ar</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="s s-Atom">float32</span><span class="p">)</span>

                <span class="s s-Atom">min_pv</span> <span class="o">=</span> <span class="s s-Atom">pv</span><span class="p">.</span><span class="nv">PolyData</span><span class="p">(</span><span class="s s-Atom">min_ar</span><span class="p">)</span>

                <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">add_point_labels</span><span class="p">(</span><span class="s s-Atom">min_pv</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

                                         <span class="s s-Atom">show_points</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span> <span class="s s-Atom">always_visible</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span>

                                         <span class="s s-Atom">pickable</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span> <span class="s s-Atom">point_color=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>

                                         <span class="s s-Atom">point_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="s s-Atom">font_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="s s-Atom">shape</span><span class="o">=</span><span class="nv">None</span><span class="p">)</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">set_background</span><span class="p">(</span><span class="s s-Atom">&#39;white&#39;</span><span class="p">)</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">show</span><span class="p">(</span><span class="s s-Atom">auto_close</span><span class="o">=</span><span class="nv">False</span><span class="p">)</span>

            <span class="s s-Atom">#</span> <span class="nv">Run</span> <span class="s s-Atom">through</span> <span class="s s-Atom">each</span> <span class="s s-Atom">frame</span>

            <span class="s s-Atom">for</span> <span class="s s-Atom">surf</span> <span class="s s-Atom">in</span> <span class="s s-Atom">surfaces</span><span class="p">:</span>

                <span class="s s-Atom">surface</span><span class="p">.</span><span class="nf">copy_from</span><span class="p">(</span><span class="s s-Atom">surf</span><span class="p">)</span>

                <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">write_frame</span><span class="p">()</span>  <span class="s s-Atom">#</span> <span class="nv">Write</span> <span class="s s-Atom">this</span> <span class="s s-Atom">frame</span>

            <span class="s s-Atom">#</span> <span class="nv">Run</span> <span class="s s-Atom">through</span> <span class="s s-Atom">backwards</span>

            <span class="s s-Atom">for</span> <span class="s s-Atom">surf</span> <span class="s s-Atom">in</span> <span class="s s-Atom">surfaces</span><span class="p">[</span><span class="o">::-</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span>

                <span class="s s-Atom">surface</span><span class="p">.</span><span class="nf">copy_from</span><span class="p">(</span><span class="s s-Atom">surf</span><span class="p">)</span>

                <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">write_frame</span><span class="p">()</span>  <span class="s s-Atom">#</span> <span class="nv">Write</span> <span class="s s-Atom">this</span> <span class="s s-Atom">frame</span>

            <span class="s s-Atom">#</span> <span class="nv">Be</span> <span class="s s-Atom">sure</span> <span class="s s-Atom">to</span> <span class="s s-Atom">close</span> <span class="s s-Atom">the</span> <span class="s s-Atom">plotter</span> <span class="s s-Atom">when</span> <span class="s s-Atom">finished</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

        <span class="s s-Atom">else</span><span class="p">:</span>

            <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;Error: gif_plot is only available for FES with 3 CVs.&quot;</span><span class="p">)</span>
</code></pre></div>

</details>
<h2 id="classes">Classes</h2>
<h3 id="minima">Minima</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Minima</span><span class="p">(</span>
    <span class="n">fes</span><span class="p">:</span> <span class="n">metadynminer</span><span class="o">.</span><span class="n">fes</span><span class="o">.</span><span class="n">Fes</span><span class="p">,</span>
    <span class="n">nbins</span><span class="o">=</span><span class="mi">8</span>
<span class="p">)</span>
</code></pre></div>

<p>Represents an object of the Minima class used to find local free energy minima on a free energy surface (FES).</p>
<p>The FES is divided into a specified number of bins (default is 8), and the absolute minima is found for each bin. 
The algorithm then checks if each found point is a local minimum by comparing it to the surrounding points on the FES.</p>
<p>The list of minima is stored as a pandas DataFrame.</p>
<p>Usage:</p>
<div class="codehilite"><pre><span></span><code><span class="n">minima</span> <span class="o">=</span> <span class="n">metadynminer</span><span class="o">.</span><span class="n">Minima</span><span class="p">(</span><span class="n">fes</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</code></pre></div>

<p>The list of minima can be accessed using the <code>minima.minima</code> attribute:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">minima</span><span class="o">.</span><span class="n">minima</span><span class="p">)</span>
</code></pre></div>

<h4 id="attributes">Attributes</h4>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>fes</td>
<td>Fes</td>
<td>The Fes object to find the minima on.</td>
<td>None</td>
</tr>
<tr>
<td>nbins</td>
<td>int, default=8</td>
<td>The number of bins used to divide the FES.</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="s s-Atom">class</span> <span class="nv">Minima</span><span class="o">:</span>

    <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    Represents an object of the Minima class used to find local free energy minima on a free energy surface (FES).</span>

<span class="s2">    The FES is divided into a specified number of bins (default is 8), and the absolute minima is found for each bin.</span>

<span class="s2">    The algorithm then checks if each found point is a local minimum by comparing it to the surrounding points on the FES.</span>

<span class="s2">    The list of minima is stored as a pandas DataFrame.</span>

<span class="s2">    Usage:</span>

<span class="s2">    ```python</span>

<span class="s2">    minima = metadynminer.Minima(fes=f, nbins=8)</span>

<span class="s2">    ```</span>

<span class="s2">    The list of minima can be accessed using the `minima.minima` attribute:</span>

<span class="s2">    ```python</span>

<span class="s2">    print(minima.minima)</span>

<span class="s2">    ```</span>

<span class="s2">    Args:</span>

<span class="s2">        fes (Fes): The Fes object to find the minima on.</span>

<span class="s2">        nbins (int, default=8): The number of bins used to divide the FES.</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="s s-Atom">def</span> <span class="k">__</span><span class="nf">init__</span><span class="p">(</span>

        <span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">fes</span><span class="p">:</span> <span class="nv">Fes</span><span class="p">,</span> <span class="s s-Atom">nbins</span><span class="o">=</span><span class="mi">8</span>

    <span class="p">)</span><span class="o">:</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">fes</span> <span class="o">is</span> <span class="nv">None</span><span class="o">:</span>

            <span class="s s-Atom">raise</span> <span class="nv">ValueError</span><span class="p">(</span><span class="s2">&quot;FES is not defined.&quot;</span><span class="p">)</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span> <span class="o">=</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">fes</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">periodic</span> <span class="o">=</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">periodic</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_select</span> <span class="o">=</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">cv_select</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_select</span><span class="p">)</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span> <span class="o">=</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">res</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_name</span> <span class="o">=</span> <span class="p">[</span><span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">hills</span><span class="p">.</span><span class="s s-Atom">cv_name</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">]</span> <span class="s s-Atom">for</span> <span class="s s-Atom">i</span> <span class="s s-Atom">in</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_select</span><span class="p">]</span>

        <span class="s s-Atom">#</span> <span class="s s-Atom">use</span> <span class="s s-Atom">remapped</span> <span class="s s-Atom">cv_min</span> <span class="s s-Atom">and</span> <span class="s s-Atom">cv_max</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span> <span class="o">=</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">cv_min</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span> <span class="o">=</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">cv_max</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_per</span> <span class="o">=</span> <span class="s s-Atom">fes</span><span class="p">.</span><span class="s s-Atom">hills</span><span class="p">.</span><span class="s s-Atom">cv_per</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">findminima</span><span class="p">(</span><span class="s s-Atom">nbins</span><span class="o">=</span><span class="s s-Atom">nbins</span><span class="p">)</span>

    <span class="s s-Atom">def</span> <span class="nf">findminima</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">nbins</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span>

        <span class="s2">&quot;&quot;&quot;Method for finding local minima on FES.</span>

<span class="s2">        Args:</span>

<span class="s2">            fes (Fes): The Fes object to find the minima on.</span>

<span class="s2">            nbins (int, default=8): The number of bins used to divide the FES.</span>

<span class="s2">        &quot;&quot;&quot;</span>

        <span class="s s-Atom">cv_min</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span>

        <span class="s s-Atom">cv_max</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span>

        <span class="s s-Atom">if</span> <span class="nf">int</span><span class="p">(</span><span class="s s-Atom">nbins</span><span class="p">)</span> <span class="p">!</span><span class="o">=</span> <span class="s s-Atom">nbins</span><span class="p">:</span>

            <span class="s s-Atom">nbins</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="s s-Atom">nbins</span><span class="p">)</span>

            <span class="nf">print</span><span class="p">(</span>

                <span class="s s-Atom">f</span><span class="s2">&quot;Number of bins must be an integer, it will be set to {nbins}.&quot;</span><span class="p">)</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span> <span class="c1">% nbins != 0:</span>

            <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;Error: Resolution of FES must be divisible by number of bins.&quot;</span><span class="p">)</span>

            <span class="s s-Atom">return</span> <span class="nv">None</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">nbins</span> <span class="o">&gt;</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="o">/</span><span class="mi">2</span><span class="o">:</span>

            <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;Error: Number of bins is too high.&quot;</span><span class="p">)</span>

            <span class="s s-Atom">return</span> <span class="nv">None</span>

        <span class="s s-Atom">bin_size</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="o">/</span><span class="s s-Atom">nbins</span><span class="p">)</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="nv">None</span>

        <span class="s s-Atom">for</span> <span class="s s-Atom">index</span> <span class="s s-Atom">in</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">ndindex</span><span class="p">(</span><span class="nf">tuple</span><span class="p">([</span><span class="s s-Atom">nbins</span><span class="p">]</span> <span class="o">*</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">))</span><span class="o">:</span>

            <span class="s s-Atom">#</span> <span class="s s-Atom">index</span> <span class="s s-Atom">serve</span> <span class="s s-Atom">as</span> <span class="s s-Atom">bin</span> <span class="s s-Atom">number</span>

            <span class="k">_</span><span class="s s-Atom">fes_slice</span> <span class="o">=</span> <span class="nf">tuple</span><span class="p">(</span>

                <span class="nf">slice</span><span class="p">(</span>

                    <span class="s s-Atom">index</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">]</span> <span class="o">*</span> <span class="s s-Atom">bin_size</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">index</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="s s-Atom">bin_size</span>

                <span class="p">)</span> <span class="s s-Atom">for</span> <span class="s s-Atom">i</span> <span class="s s-Atom">in</span> <span class="nf">range</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">)</span>

            <span class="p">)</span>

            <span class="s s-Atom">fes_slice</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">[</span><span class="k">_</span><span class="s s-Atom">fes_slice</span><span class="p">]</span>

            <span class="s s-Atom">bin_min</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="s s-Atom">fes_slice</span><span class="p">)</span>

            <span class="s s-Atom">#</span> <span class="s s-Atom">indexes</span> <span class="s s-Atom">of</span> <span class="s s-Atom">global</span> <span class="s s-Atom">minimum</span> <span class="s s-Atom">of</span> <span class="s s-Atom">a</span> <span class="s s-Atom">bin</span>

            <span class="s s-Atom">bin_min_arg</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">unravel_index</span><span class="p">(</span>

                <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">argmin</span><span class="p">(</span><span class="s s-Atom">fes_slice</span><span class="p">),</span> <span class="s s-Atom">fes_slice</span><span class="p">.</span><span class="s s-Atom">shape</span>

            <span class="p">)</span>

            <span class="s s-Atom">#</span> <span class="s s-Atom">indexes</span> <span class="s s-Atom">of</span> <span class="s s-Atom">that</span> <span class="s s-Atom">minima</span> <span class="s s-Atom">in</span> <span class="s s-Atom">the</span> <span class="s s-Atom">original</span> <span class="nf">fes</span> <span class="p">(</span><span class="s s-Atom">indexes</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span>

            <span class="s s-Atom">min_cv_b</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span>

                <span class="s s-Atom">bin_min_arg</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">]</span> <span class="o">+</span> <span class="s s-Atom">index</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">]</span> <span class="o">*</span> <span class="s s-Atom">bin_size</span> <span class="s s-Atom">for</span> <span class="s s-Atom">i</span> <span class="s s-Atom">in</span> <span class="nf">range</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">)</span>

            <span class="p">],</span> <span class="s s-Atom">dtype</span><span class="o">=</span><span class="s s-Atom">int</span><span class="p">)</span>

            <span class="nf">if</span> <span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="s s-Atom">bin_min_arg</span><span class="p">,</span> <span class="s s-Atom">dtype</span><span class="o">=</span><span class="s s-Atom">int</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">).</span><span class="nf">all</span><span class="p">()</span> <span class="s s-Atom">and</span> <span class="s s-Atom">\</span>

                    <span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="s s-Atom">bin_min_arg</span><span class="p">,</span> <span class="s s-Atom">dtype</span><span class="o">=</span><span class="s s-Atom">int</span><span class="p">)</span> <span class="o">&lt;</span> <span class="s s-Atom">bin_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">).</span><span class="nf">all</span><span class="p">()</span><span class="o">:</span>

                <span class="s s-Atom">#</span> <span class="s s-Atom">if</span> <span class="s s-Atom">the</span> <span class="s s-Atom">minima</span> <span class="o">is</span> <span class="o">not</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="s s-Atom">edge</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">bin</span>

                <span class="s s-Atom">min_cv</span> <span class="o">=</span> <span class="p">(((</span><span class="s s-Atom">min_cv_b</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="s s-Atom">cv_max</span><span class="o">-</span><span class="s s-Atom">cv_min</span><span class="p">))</span><span class="o">+</span><span class="s s-Atom">cv_min</span>

                <span class="s s-Atom">local_minima</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">([</span>

                    <span class="p">[</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="s s-Atom">bin_min</span><span class="p">,</span> <span class="mi">6</span><span class="p">)],</span> <span class="s s-Atom">min_cv_b</span><span class="p">,</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="s s-Atom">min_cv</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

                <span class="p">])</span>

                <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">is</span> <span class="nv">None</span><span class="o">:</span>

                    <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">local_minima</span>

                <span class="s s-Atom">else</span><span class="p">:</span>

                    <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">vstack</span><span class="p">((</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">,</span> <span class="s s-Atom">local_minima</span><span class="p">))</span>

            <span class="s s-Atom">else</span><span class="p">:</span>

                <span class="s s-Atom">#</span> <span class="s s-Atom">if</span> <span class="s s-Atom">the</span> <span class="s s-Atom">minima</span> <span class="o">is</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="s s-Atom">edge</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">bin</span>

                <span class="s s-Atom">around</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="nf">tuple</span><span class="p">([</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">))</span>

                <span class="s s-Atom">for</span> <span class="s s-Atom">product_index</span> <span class="s s-Atom">in</span> <span class="nf">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span> <span class="o">*</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">)</span><span class="o">:</span>

                    <span class="s s-Atom">converted_index</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="s s-Atom">product_index</span><span class="p">,</span> <span class="s s-Atom">dtype</span><span class="o">=</span><span class="s s-Atom">int</span><span class="p">)</span> <span class="o">+</span> <span class="s s-Atom">\</span>

                        <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="s s-Atom">min_cv_b</span><span class="p">,</span> <span class="s s-Atom">dtype</span><span class="o">=</span><span class="s s-Atom">int</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

                    <span class="s s-Atom">converted_index</span><span class="p">[</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">periodic</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">\</span>

                        <span class="s s-Atom">converted_index</span><span class="p">[</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">periodic</span><span class="p">]</span> <span class="c1">% self.res</span>

                    <span class="s s-Atom">mask</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span>

                        <span class="p">(</span><span class="s s-Atom">converted_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s s-Atom">converted_index</span> <span class="o">&gt;</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="s s-Atom">if</span> <span class="nf">len</span><span class="p">(</span><span class="s s-Atom">mask</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">:</span>

                        <span class="s s-Atom">around</span><span class="p">[</span><span class="s s-Atom">product_index</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="s s-Atom">inf</span>

                    <span class="s s-Atom">elif</span> <span class="s s-Atom">product_index</span> <span class="o">==</span> <span class="nf">tuple</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">)</span><span class="o">:</span>

                        <span class="s s-Atom">around</span><span class="p">[</span><span class="s s-Atom">product_index</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="s s-Atom">inf</span>

                    <span class="s s-Atom">else</span><span class="p">:</span>

                        <span class="s s-Atom">around</span><span class="p">[</span><span class="s s-Atom">product_index</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">[</span><span class="nf">tuple</span><span class="p">(</span>

                            <span class="s s-Atom">converted_index</span><span class="p">)]</span>

                <span class="nf">if</span> <span class="p">(</span><span class="s s-Atom">around</span> <span class="o">&gt;</span> <span class="s s-Atom">bin_min</span><span class="p">).</span><span class="nf">all</span><span class="p">()</span><span class="o">:</span>

                    <span class="s s-Atom">min_cv</span> <span class="o">=</span> <span class="p">(((</span><span class="s s-Atom">min_cv_b</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="s s-Atom">cv_max</span><span class="o">-</span><span class="s s-Atom">cv_min</span><span class="p">))</span><span class="o">+</span><span class="s s-Atom">cv_min</span>

                    <span class="s s-Atom">local_minima</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">([</span>

                        <span class="p">[</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="s s-Atom">bin_min</span><span class="p">,</span> <span class="mi">6</span><span class="p">)],</span> <span class="s s-Atom">min_cv_b</span><span class="p">,</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="s s-Atom">min_cv</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

                    <span class="p">])</span>

                    <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">is</span> <span class="nv">None</span><span class="o">:</span>

                        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">local_minima</span>

                    <span class="s s-Atom">else</span><span class="p">:</span>

                        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">vstack</span><span class="p">((</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">,</span> <span class="s s-Atom">local_minima</span><span class="p">))</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">is</span> <span class="nv">None</span><span class="o">:</span>

            <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;No minima found.&quot;</span><span class="p">)</span>

            <span class="s s-Atom">return</span> <span class="nv">None</span>

        <span class="s s-Atom">if</span> <span class="nf">len</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">:</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">[</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">argsort</span><span class="p">()]</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="o">:</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">((</span>

                <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">dtype</span><span class="o">=</span><span class="s s-Atom">int</span><span class="p">),</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span>

            <span class="p">))</span>

        <span class="s s-Atom">else</span><span class="p">:</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">column_stack</span><span class="p">((</span>

                <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">dtype</span><span class="o">=</span><span class="s s-Atom">int</span><span class="p">),</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span>

            <span class="p">))</span>

        <span class="s s-Atom">minima_df</span> <span class="o">=</span> <span class="s s-Atom">pd</span><span class="p">.</span><span class="nv">DataFrame</span><span class="p">(</span>

            <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">),</span>

            <span class="s s-Atom">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Minimum&quot;</span><span class="p">,</span> <span class="s2">&quot;free energy&quot;</span><span class="p">]</span> <span class="o">+</span>

            <span class="p">[</span><span class="s s-Atom">f</span><span class="s2">&quot;CV{i+1}bin&quot;</span> <span class="s s-Atom">for</span> <span class="s s-Atom">i</span> <span class="s s-Atom">in</span> <span class="nf">range</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">)]</span> <span class="o">+</span>

            <span class="p">[</span><span class="s s-Atom">f</span><span class="s2">&quot;CV{i+1} - {self.cv_name[i]}&quot;</span> <span class="s s-Atom">for</span> <span class="s s-Atom">i</span> <span class="s s-Atom">in</span> <span class="nf">range</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span><span class="p">)]</span>

        <span class="p">)</span>

        <span class="s s-Atom">minima_df</span><span class="p">[</span><span class="s2">&quot;Minimum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">minima_df</span><span class="p">[</span><span class="s2">&quot;Minimum&quot;</span><span class="p">].</span><span class="nf">astype</span><span class="p">(</span><span class="s s-Atom">int</span><span class="p">)</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span> <span class="o">=</span> <span class="s s-Atom">minima_df</span>

    <span class="s s-Atom">def</span> <span class="nf">plot</span><span class="p">(</span>

        <span class="s s-Atom">self</span><span class="p">,</span>

        <span class="s s-Atom">png_name</span><span class="o">:</span> <span class="nv">Optional</span><span class="p">[</span><span class="s s-Atom">str</span><span class="p">]</span> <span class="o">=</span> <span class="nv">None</span><span class="p">,</span>

        <span class="s s-Atom">contours</span><span class="p">:</span> <span class="s s-Atom">bool</span> <span class="o">=</span> <span class="nv">True</span><span class="p">,</span>

        <span class="s s-Atom">contours_spacing</span><span class="o">:</span> <span class="s s-Atom">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>

        <span class="s s-Atom">aspect</span><span class="p">:</span> <span class="s s-Atom">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>

        <span class="s s-Atom">cmap</span><span class="p">:</span> <span class="s s-Atom">str</span> <span class="o">=</span> <span class="s2">&quot;jet&quot;</span><span class="p">,</span>

        <span class="s s-Atom">energy_unit</span><span class="o">:</span> <span class="s s-Atom">str</span> <span class="o">=</span> <span class="s2">&quot;kJ/mol&quot;</span><span class="p">,</span>

        <span class="s s-Atom">xlabel</span><span class="p">:</span> <span class="nv">Optional</span><span class="p">[</span><span class="s s-Atom">str</span><span class="p">]</span> <span class="o">=</span> <span class="nv">None</span><span class="p">,</span>

        <span class="s s-Atom">ylabel</span><span class="p">:</span> <span class="nv">Optional</span><span class="p">[</span><span class="s s-Atom">str</span><span class="p">]</span> <span class="o">=</span> <span class="nv">None</span><span class="p">,</span>

        <span class="s s-Atom">zlabel</span><span class="p">:</span> <span class="nv">Optional</span><span class="p">[</span><span class="s s-Atom">str</span><span class="p">]</span> <span class="o">=</span> <span class="nv">None</span><span class="p">,</span>

        <span class="s s-Atom">label_size</span><span class="o">:</span> <span class="s s-Atom">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>

        <span class="s s-Atom">image_size</span><span class="o">:</span> <span class="nv">List</span><span class="p">[</span><span class="s s-Atom">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>

        <span class="s s-Atom">color</span><span class="p">:</span> <span class="nv">Optional</span><span class="p">[</span><span class="s s-Atom">str</span><span class="p">]</span> <span class="o">=</span> <span class="nv">None</span><span class="p">,</span>

        <span class="s s-Atom">vmin</span><span class="p">:</span> <span class="s s-Atom">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

        <span class="s s-Atom">vmax</span><span class="p">:</span> <span class="nv">Optional</span><span class="p">[</span><span class="s s-Atom">float</span><span class="p">]</span> <span class="o">=</span> <span class="nv">None</span><span class="p">,</span>

        <span class="s s-Atom">opacity</span><span class="p">:</span> <span class="s s-Atom">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>

        <span class="s s-Atom">levels</span><span class="p">:</span> <span class="nv">Optional</span><span class="p">[</span><span class="nv">List</span><span class="p">[</span><span class="s s-Atom">float</span><span class="p">]]</span> <span class="o">=</span> <span class="nv">None</span><span class="p">,</span>

        <span class="s s-Atom">show_points</span><span class="o">:</span> <span class="s s-Atom">bool</span> <span class="o">=</span> <span class="nv">True</span><span class="p">,</span>

        <span class="s s-Atom">point_size</span><span class="o">:</span> <span class="s s-Atom">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>

    <span class="p">)</span><span class="o">:</span>

        <span class="s2">&quot;&quot;</span><span class="err">&quot;</span>

        <span class="nv">Function</span> <span class="s s-Atom">used</span> <span class="s s-Atom">to</span> <span class="s s-Atom">visualize</span> <span class="s s-Atom">the</span> <span class="nv">FES</span> <span class="s s-Atom">objects</span> <span class="s s-Atom">with</span> <span class="s s-Atom">the</span> <span class="s s-Atom">positions</span> <span class="s s-Atom">of</span> <span class="s s-Atom">local</span> <span class="s s-Atom">minima</span> <span class="s s-Atom">shown</span> <span class="s s-Atom">as</span> <span class="s s-Atom">letters</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="s s-Atom">graph</span><span class="p">.</span>

        <span class="nv">Usage</span><span class="o">:</span>

        <span class="err">```</span><span class="s s-Atom">python</span>

        <span class="s s-Atom">minima</span><span class="p">.</span><span class="nf">plot</span><span class="p">()</span>

        <span class="err">```</span>

        <span class="nv">Args</span><span class="o">:</span>

            <span class="nf">png_name</span> <span class="p">(</span><span class="s s-Atom">str</span><span class="p">,</span> <span class="s s-Atom">optional</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">If</span> <span class="s s-Atom">provided</span><span class="p">,</span> <span class="s s-Atom">the</span> <span class="s s-Atom">picture</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="nv">FES</span> <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">saved</span> <span class="s s-Atom">under</span> <span class="s s-Atom">this</span> <span class="s s-Atom">name</span> <span class="s s-Atom">to</span> <span class="s s-Atom">the</span> <span class="s s-Atom">current</span> <span class="s s-Atom">working</span> <span class="s s-Atom">directory</span><span class="p">.</span>

            <span class="nf">contours</span> <span class="p">(</span><span class="s s-Atom">bool</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">Specifies</span> <span class="s s-Atom">whether</span> <span class="s s-Atom">contours</span> <span class="s s-Atom">should</span> <span class="s s-Atom">be</span> <span class="s s-Atom">shown</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="mi">2</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span>

            <span class="nf">contours_spacing</span> <span class="p">(</span><span class="s s-Atom">float</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">When</span> <span class="s s-Atom">a</span> <span class="s s-Atom">positive</span> <span class="s s-Atom">number</span> <span class="o">is</span> <span class="s s-Atom">set</span><span class="p">,</span> <span class="s s-Atom">it</span> <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">used</span> <span class="s s-Atom">as</span> <span class="s s-Atom">the</span> <span class="s s-Atom">spacing</span> <span class="s s-Atom">for</span> <span class="s s-Atom">contours</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="mi">2</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span> <span class="s s-Atom">\</span>

                <span class="nv">Otherwise</span><span class="p">,</span> <span class="s s-Atom">if</span> <span class="s s-Atom">contours</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span> <span class="s s-Atom">there</span> <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">five</span> <span class="s s-Atom">equally</span> <span class="s s-Atom">spaced</span> <span class="s s-Atom">contour</span> <span class="s s-Atom">levels</span><span class="p">.</span>

            <span class="nf">aspect</span> <span class="p">(</span><span class="s s-Atom">float</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">The</span> <span class="s s-Atom">aspect</span> <span class="s s-Atom">ratio</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">graph</span><span class="p">.</span> <span class="nv">Works</span> <span class="s s-Atom">with</span> <span class="mi">1</span><span class="nv">D</span> <span class="s s-Atom">and</span> <span class="mi">2</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span>

            <span class="nf">cmap</span> <span class="p">(</span><span class="s s-Atom">str</span><span class="p">,</span> <span class="s s-Atom">default=</span><span class="s2">&quot;jet&quot;</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">The</span> <span class="nv">Matplotlib</span> <span class="s s-Atom">colormap</span> <span class="s s-Atom">used</span> <span class="s s-Atom">to</span> <span class="s s-Atom">color</span> <span class="s s-Atom">the</span> <span class="mi">2</span><span class="nv">D</span> <span class="s s-Atom">or</span> <span class="mi">3</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span>

            <span class="nf">energy_unit</span> <span class="p">(</span><span class="s s-Atom">str</span><span class="p">,</span> <span class="s s-Atom">default=</span><span class="s2">&quot;kJ/mol&quot;</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">A</span> <span class="s s-Atom">string</span> <span class="s s-Atom">used</span> <span class="s s-Atom">in</span> <span class="s s-Atom">the</span> <span class="s s-Atom">description</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">colorbar</span><span class="p">.</span>

            <span class="s s-Atom">xlabel</span><span class="p">,</span> <span class="s s-Atom">ylabel</span><span class="p">,</span> <span class="nf">zlabel</span> <span class="p">(</span><span class="s s-Atom">str</span><span class="p">,</span> <span class="s s-Atom">optional</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">If</span> <span class="s s-Atom">provided</span><span class="p">,</span> <span class="s s-Atom">they</span> <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">used</span> <span class="s s-Atom">as</span> <span class="s s-Atom">labels</span> <span class="s s-Atom">for</span> <span class="s s-Atom">the</span> <span class="s s-Atom">graphs</span><span class="p">.</span>

            <span class="nf">label_size</span> <span class="p">(</span><span class="s s-Atom">int</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">:</span> <span class="nv">The</span> <span class="s s-Atom">size</span> <span class="s s-Atom">of</span> <span class="s s-Atom">text</span> <span class="s s-Atom">in</span> <span class="s s-Atom">labels</span><span class="p">.</span>

            <span class="nf">image_size</span> <span class="p">(</span><span class="nv">List</span><span class="p">[</span><span class="s s-Atom">int</span><span class="p">],</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span><span class="o">:</span> <span class="nv">The</span> <span class="s s-Atom">width</span> <span class="s s-Atom">and</span> <span class="s s-Atom">height</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">picture</span><span class="p">.</span>

            <span class="nf">color</span> <span class="p">(</span><span class="s s-Atom">str</span><span class="p">,</span> <span class="s s-Atom">optional</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">The</span> <span class="s s-Atom">name</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">color</span> <span class="s s-Atom">in</span> <span class="nv">Matplotlib</span><span class="p">.</span> <span class="s s-Atom">\</span>

                <span class="nv">If</span> <span class="s s-Atom">set</span><span class="p">,</span> <span class="s s-Atom">the</span> <span class="s s-Atom">color</span> <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">used</span> <span class="s s-Atom">for</span> <span class="s s-Atom">the</span> <span class="s s-Atom">letters</span><span class="p">.</span> <span class="s s-Atom">\</span>

                <span class="nv">If</span> <span class="o">not</span> <span class="s s-Atom">set</span><span class="p">,</span> <span class="s s-Atom">the</span> <span class="s s-Atom">color</span> <span class="s s-Atom">should</span> <span class="s s-Atom">be</span> <span class="s s-Atom">automatically</span> <span class="s s-Atom">either</span> <span class="s s-Atom">black</span> <span class="s s-Atom">or</span> <span class="s s-Atom">white</span><span class="p">,</span> <span class="s s-Atom">\</span>

                <span class="s s-Atom">depending</span> <span class="s s-Atom">on</span> <span class="s s-Atom">what</span> <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">more</span> <span class="s s-Atom">visible</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="s s-Atom">given</span> <span class="s s-Atom">place</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="nv">FES</span> <span class="s s-Atom">with</span> <span class="s s-Atom">the</span> <span class="s s-Atom">given</span> <span class="nf">colormap</span> <span class="p">(</span><span class="s s-Atom">for</span> <span class="mi">2</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">).</span>

            <span class="nf">vmin</span> <span class="p">(</span><span class="s s-Atom">float</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">:</span> <span class="nv">The</span> <span class="s s-Atom">lower</span> <span class="s s-Atom">bound</span> <span class="s s-Atom">for</span> <span class="s s-Atom">the</span> <span class="s s-Atom">colormap</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="mi">2</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span>

            <span class="nf">vmax</span> <span class="p">(</span><span class="s s-Atom">float</span><span class="p">,</span> <span class="s s-Atom">optional</span><span class="p">)</span><span class="o">:</span> <span class="nv">The</span> <span class="s s-Atom">upper</span> <span class="s s-Atom">bound</span> <span class="s s-Atom">for</span> <span class="s s-Atom">the</span> <span class="s s-Atom">colormap</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="mi">2</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span>

            <span class="nf">opacity</span> <span class="p">(</span><span class="s s-Atom">float</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">A</span> <span class="s s-Atom">number</span> <span class="s s-Atom">between</span> <span class="mi">0</span> <span class="s s-Atom">and</span> <span class="mi">1</span> <span class="s s-Atom">representing</span> <span class="s s-Atom">the</span> <span class="s s-Atom">opacity</span> <span class="s s-Atom">of</span> <span class="s s-Atom">isosurfaces</span> <span class="s s-Atom">in</span> <span class="s s-Atom">the</span> <span class="mi">3</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span>

            <span class="nf">levels</span> <span class="p">(</span><span class="nv">List</span><span class="p">[</span><span class="s s-Atom">float</span><span class="p">],</span> <span class="s s-Atom">optional</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">A</span> <span class="s s-Atom">list</span> <span class="s s-Atom">of</span> <span class="s s-Atom">free</span> <span class="s s-Atom">energy</span> <span class="nb">val</span><span class="s s-Atom">ues</span> <span class="s s-Atom">for</span> <span class="s s-Atom">isosurfaces</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="mi">3</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span> <span class="s s-Atom">\</span>

                <span class="nv">If</span> <span class="o">not</span> <span class="s s-Atom">provided</span><span class="p">,</span> <span class="s s-Atom">default</span> <span class="nb">val</span><span class="s s-Atom">ues</span> <span class="s s-Atom">from</span> <span class="s s-Atom">the</span> <span class="s s-Atom">contours</span> <span class="s s-Atom">parameters</span> <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">used</span> <span class="s s-Atom">instead</span><span class="p">.</span>

            <span class="nf">show_points</span> <span class="p">(</span><span class="s s-Atom">bool</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">Specifies</span> <span class="s s-Atom">whether</span> <span class="s s-Atom">points</span> <span class="s s-Atom">should</span> <span class="s s-Atom">be</span> <span class="s s-Atom">visualized</span> <span class="s s-Atom">instead</span> <span class="s s-Atom">of</span> <span class="s s-Atom">just</span> <span class="s s-Atom">the</span> <span class="s s-Atom">letters</span><span class="p">.</span> <span class="s s-Atom">\</span>

                <span class="nv">Only</span> <span class="s s-Atom">applicable</span> <span class="s s-Atom">for</span> <span class="mi">3</span><span class="nv">D</span> <span class="nv">FES</span><span class="p">.</span>

            <span class="nf">point_size</span> <span class="p">(</span><span class="s s-Atom">float</span><span class="p">,</span> <span class="s s-Atom">default</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span><span class="o">:</span> <span class="s s-Atom">\</span>

                <span class="nv">The</span> <span class="s s-Atom">size</span> <span class="s s-Atom">of</span> <span class="s s-Atom">points</span> <span class="s s-Atom">if</span> <span class="s s-Atom">show_points</span><span class="o">=</span><span class="nv">True</span><span class="p">.</span>

        <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        import matplotlib.pyplot as plt</span>

<span class="s2">        import matplotlib.cm as cm</span>

<span class="s2">        if vmax == None:</span>

<span class="s2">            # if the addition is smaller than 0.01, the 3d plot stops working.</span>

<span class="s2">            vmax = np.max(self.fes) + 0.01</span>

<span class="s2">        if contours_spacing == 0.0:</span>

<span class="s2">            contours_spacing = (vmax-vmin)/5.0</span>

<span class="s2">        color_map = cm.get_cmap(cmap)</span>

<span class="s2">        color_map.set_over(&quot;</span><span class="s s-Atom">white</span><span class="s2">&quot;)</span>

<span class="s2">        color_map.set_under(&quot;</span><span class="s s-Atom">white</span><span class="s2">&quot;)</span>

<span class="s2">        color_set = True</span>

<span class="s2">        if color == None:</span>

<span class="s2">            color_set = False</span>

<span class="s2">        if self.cvs == 1:</span>

<span class="s2">            cv1min = self.cv_min[0]</span>

<span class="s2">            cv1max = self.cv_max[0]</span>

<span class="s2">            plt.figure(figsize=(image_size[0], image_size[1]))</span>

<span class="s2">            X = np.linspace(cv1min, cv1max, self.res)</span>

<span class="s2">            plt.plot(X, self.fes)</span>

<span class="s2">            if not color_set:</span>

<span class="s2">                color = &quot;</span><span class="s s-Atom">black</span><span class="err">&quot;</span>

            <span class="s s-Atom">ferange</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">)</span> <span class="o">-</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="o">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">text</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s s-Atom">ferange</span><span class="o">*</span><span class="mf">0.05</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

                         <span class="s s-Atom">fontsize</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">,</span> <span class="s s-Atom">horizontalalignment=&#39;center&#39;</span><span class="p">,</span>

                         <span class="s s-Atom">verticalalignment=&#39;bottom&#39;</span><span class="p">,</span> <span class="s s-Atom">c</span><span class="o">=</span><span class="s s-Atom">color</span><span class="p">)</span>

            <span class="s s-Atom">elif</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">:</span>

                <span class="s s-Atom">for</span> <span class="s s-Atom">m</span> <span class="s s-Atom">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span><span class="o">:</span>

                    <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">text</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="s s-Atom">m</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="s s-Atom">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s s-Atom">ferange</span><span class="o">*</span><span class="mf">0.05</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="s s-Atom">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

                             <span class="s s-Atom">fontsize</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">,</span> <span class="s s-Atom">horizontalalignment=&#39;center&#39;</span><span class="p">,</span>

                             <span class="s s-Atom">verticalalignment=&#39;bottom&#39;</span><span class="p">,</span> <span class="s s-Atom">c</span><span class="o">=</span><span class="s s-Atom">color</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">xlabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="s s-Atom">f&#39;CV1 - {self.cv_name[0]}&#39;</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

            <span class="s s-Atom">else</span><span class="p">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="s s-Atom">xlabel</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">ylabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="s s-Atom">f&#39;free energy ({energy_unit})&#39;</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

            <span class="s s-Atom">else</span><span class="p">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="s s-Atom">ylabel</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

        <span class="s s-Atom">elif</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span> <span class="o">==</span> <span class="mi">2</span><span class="o">:</span>

            <span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv2min</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="s s-Atom">cv1max</span><span class="p">,</span> <span class="s s-Atom">cv2max</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="s s-Atom">fig</span> <span class="o">=</span> <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="s s-Atom">figsize=</span><span class="p">(</span><span class="s s-Atom">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">rot90</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">,</span> <span class="s s-Atom">axes=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="s s-Atom">cmap</span><span class="o">=</span><span class="s s-Atom">color_map</span><span class="p">,</span> <span class="s s-Atom">interpolation=&#39;nearest&#39;</span><span class="p">,</span>

                       <span class="s s-Atom">extent</span><span class="o">=</span><span class="p">[</span><span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv1max</span><span class="p">,</span> <span class="s s-Atom">cv2min</span><span class="p">,</span> <span class="s s-Atom">cv2max</span><span class="p">],</span>

                       <span class="s s-Atom">aspect=</span><span class="p">(((</span><span class="s s-Atom">cv1max</span><span class="o">-</span><span class="s s-Atom">cv1min</span><span class="p">)</span><span class="s s-Atom">/</span><span class="p">(</span><span class="s s-Atom">cv2max</span><span class="o">-</span><span class="s s-Atom">cv2min</span><span class="p">))</span><span class="s s-Atom">/</span><span class="p">(</span><span class="s s-Atom">aspect</span><span class="p">)),</span>

                       <span class="s s-Atom">vmin</span><span class="o">=</span><span class="s s-Atom">vmin</span><span class="p">,</span> <span class="s s-Atom">vmax</span><span class="o">=</span><span class="s s-Atom">vmax</span><span class="p">)</span>

            <span class="s s-Atom">cbar</span> <span class="o">=</span> <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">colorbar</span><span class="p">()</span>

            <span class="s s-Atom">cbar</span><span class="p">.</span><span class="nf">set_label</span><span class="p">(</span><span class="s s-Atom">energy_unit</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="o">:</span>

                <span class="s s-Atom">background</span> <span class="o">=</span> <span class="nf">color_map</span><span class="p">(</span>

                    <span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="s s-Atom">vmin</span><span class="p">)</span><span class="s s-Atom">/</span><span class="p">(</span><span class="s s-Atom">vmax</span><span class="o">-</span><span class="s s-Atom">vmin</span><span class="p">))</span>

                <span class="s s-Atom">luma</span> <span class="o">=</span> <span class="s s-Atom">background</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">0.2126</span><span class="o">+</span><span class="s s-Atom">background</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="s s-Atom">\</span>

                    <span class="mf">0.7152</span><span class="o">+</span><span class="s s-Atom">background</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mf">0.0722</span>

                <span class="s s-Atom">if</span> <span class="s s-Atom">luma</span> <span class="o">&gt;</span> <span class="mf">0.6</span> <span class="s s-Atom">and</span> <span class="o">not</span> <span class="s s-Atom">color_set</span><span class="o">:</span>

                    <span class="s s-Atom">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>

                <span class="s s-Atom">elif</span> <span class="s s-Atom">luma</span> <span class="s s-Atom">&lt;=</span> <span class="mf">0.6</span> <span class="s s-Atom">and</span> <span class="o">not</span> <span class="s s-Atom">color_set</span><span class="o">:</span>

                    <span class="s s-Atom">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">text</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

                         <span class="s s-Atom">fontsize</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">,</span> <span class="s s-Atom">horizontalalignment=&#39;center&#39;</span><span class="p">,</span>

                         <span class="s s-Atom">verticalalignment=&#39;center&#39;</span><span class="p">,</span> <span class="s s-Atom">c</span><span class="o">=</span><span class="s s-Atom">color</span><span class="p">)</span>

            <span class="s s-Atom">elif</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">:</span>

                <span class="s s-Atom">for</span> <span class="s s-Atom">m</span> <span class="s s-Atom">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span><span class="o">:</span>

                    <span class="s s-Atom">background</span> <span class="o">=</span> <span class="nf">color_map</span><span class="p">(</span>

                        <span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="s s-Atom">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="s s-Atom">vmin</span><span class="p">)</span><span class="s s-Atom">/</span><span class="p">(</span><span class="s s-Atom">vmax</span><span class="o">-</span><span class="s s-Atom">vmin</span><span class="p">))</span>

                    <span class="s s-Atom">luma</span> <span class="o">=</span> <span class="s s-Atom">background</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">0.2126</span> <span class="o">+</span> <span class="s s-Atom">\</span>

                        <span class="s s-Atom">background</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">0.7152</span><span class="o">+</span><span class="s s-Atom">background</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mf">0.0722</span>

                    <span class="s s-Atom">if</span> <span class="s s-Atom">luma</span> <span class="o">&gt;</span> <span class="mf">0.6</span> <span class="s s-Atom">and</span> <span class="o">not</span> <span class="s s-Atom">color_set</span><span class="o">:</span>

                        <span class="s s-Atom">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>

                    <span class="s s-Atom">elif</span> <span class="s s-Atom">luma</span> <span class="s s-Atom">&lt;=</span> <span class="mf">0.6</span> <span class="s s-Atom">and</span> <span class="o">not</span> <span class="s s-Atom">color_set</span><span class="o">:</span>

                        <span class="s s-Atom">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>

                    <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">text</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="s s-Atom">m</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="nf">float</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="s s-Atom">m</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="s s-Atom">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

                             <span class="s s-Atom">fontsize</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">,</span> <span class="s s-Atom">horizontalalignment=&#39;center&#39;</span><span class="p">,</span>

                             <span class="s s-Atom">verticalalignment=&#39;center&#39;</span><span class="p">,</span> <span class="s s-Atom">c</span><span class="o">=</span><span class="s s-Atom">color</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">contours</span><span class="p">:</span>

                <span class="s s-Atom">cont</span> <span class="o">=</span> <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">contour</span><span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">rot90</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">,</span> <span class="s s-Atom">axes=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>

                                   <span class="s s-Atom">levels</span><span class="o">=</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span>

                                       <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">vmax</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">),</span> <span class="s s-Atom">contours_spacing</span><span class="p">),</span>

                                   <span class="s s-Atom">extent</span><span class="o">=</span><span class="p">[</span><span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv1max</span><span class="p">,</span> <span class="s s-Atom">cv2max</span><span class="p">,</span> <span class="s s-Atom">cv2min</span><span class="p">],</span>

                                   <span class="s s-Atom">colors=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">clabel</span><span class="p">(</span><span class="s s-Atom">cont</span><span class="p">,</span> <span class="s s-Atom">levels</span><span class="o">=</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span>

                    <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">vmax</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">),</span> <span class="s s-Atom">contours_spacing</span><span class="p">))</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">xlabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="s s-Atom">f&#39;CV1 - {self.cv_name[0]}&#39;</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

            <span class="s s-Atom">else</span><span class="p">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="s s-Atom">xlabel</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">ylabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="s s-Atom">f&#39;CV2 - {self.cv_name[1]}&#39;</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

            <span class="s s-Atom">else</span><span class="p">:</span>

                <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="s s-Atom">ylabel</span><span class="p">,</span> <span class="s s-Atom">size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">)</span>

        <span class="s s-Atom">elif</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span> <span class="o">==</span> <span class="mi">3</span><span class="o">:</span>

            <span class="s s-Atom">try</span><span class="p">:</span>

                <span class="s s-Atom">import</span> <span class="s s-Atom">pyvista</span> <span class="s s-Atom">as</span> <span class="s s-Atom">pv</span>

            <span class="nf">except</span> <span class="p">(</span><span class="nv">ImportError</span><span class="p">,</span> <span class="nv">ModuleNotFoundError</span><span class="p">)</span> <span class="s s-Atom">as</span> <span class="s s-Atom">e</span><span class="p">:</span>

                <span class="nf">print</span><span class="p">(</span><span class="s s-Atom">e</span><span class="p">)</span>

                <span class="s s-Atom">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv2min</span><span class="p">,</span> <span class="s s-Atom">cv3min</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="s s-Atom">cv1max</span><span class="p">,</span> <span class="s s-Atom">cv2max</span><span class="p">,</span> <span class="s s-Atom">cv3max</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">xlabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">xlabel</span> <span class="o">=</span> <span class="s2">&quot;CV1 - &quot;</span> <span class="o">+</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">ylabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">ylabel</span> <span class="o">=</span> <span class="s2">&quot;CV2 - &quot;</span> <span class="o">+</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">zlabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">zlabel</span> <span class="o">=</span> <span class="s2">&quot;CV3 - &quot;</span> <span class="o">+</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="s s-Atom">min_ar</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">5</span><span class="o">:</span><span class="mi">8</span><span class="p">].</span><span class="nb">val</span><span class="s s-Atom">ues</span>

            <span class="s s-Atom">min_ar</span> <span class="o">=</span> <span class="s s-Atom">min_ar</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="s s-Atom">float32</span><span class="p">)</span>

            <span class="s s-Atom">min_pv</span> <span class="o">=</span> <span class="s s-Atom">pv</span><span class="p">.</span><span class="nv">PolyData</span><span class="p">(</span><span class="s s-Atom">min_ar</span><span class="p">)</span>

            <span class="s s-Atom">grid</span> <span class="o">=</span> <span class="s s-Atom">pv</span><span class="p">.</span><span class="nv">UniformGrid</span><span class="p">(</span>

                <span class="s s-Atom">dimensions=</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">),</span>

                <span class="s s-Atom">spacing=</span><span class="p">((</span><span class="s s-Atom">cv1max</span><span class="o">-</span><span class="s s-Atom">cv1min</span><span class="p">)</span><span class="o">/</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">cv2max</span><span class="o">-</span><span class="s s-Atom">cv2min</span><span class="p">)</span> <span class="o">/</span>

                         <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">cv3max</span><span class="o">-</span><span class="s s-Atom">cv3min</span><span class="p">)</span><span class="o">/</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">),</span>

                <span class="s s-Atom">origin=</span><span class="p">(</span><span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv2min</span><span class="p">,</span> <span class="s s-Atom">cv3min</span><span class="p">)</span>

            <span class="p">)</span>

            <span class="s s-Atom">grid</span><span class="p">[</span><span class="s2">&quot;vol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">.</span><span class="nf">ravel</span><span class="p">(</span><span class="s s-Atom">order=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">levels</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">contours</span> <span class="o">=</span> <span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">contour</span><span class="p">(</span>

                    <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">vmax</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">),</span> <span class="s s-Atom">contours_spacing</span><span class="p">))</span>

            <span class="s s-Atom">else</span><span class="p">:</span>

                <span class="s s-Atom">contours</span> <span class="o">=</span> <span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">contour</span><span class="p">(</span><span class="s s-Atom">levels</span><span class="p">)</span>

            <span class="s s-Atom">fescolors</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="s s-Atom">for</span> <span class="s s-Atom">i</span> <span class="s s-Atom">in</span> <span class="nf">range</span><span class="p">(</span><span class="s s-Atom">contours</span><span class="p">.</span><span class="s s-Atom">points</span><span class="p">.</span><span class="s s-Atom">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">:</span>

                <span class="s s-Atom">fescolors</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">[</span><span class="nf">int</span><span class="p">((</span><span class="s s-Atom">contours</span><span class="p">.</span><span class="s s-Atom">points</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="s s-Atom">cv1min</span><span class="p">)</span><span class="o">*</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res/</span><span class="p">(</span><span class="s s-Atom">cv1max</span><span class="o">-</span><span class="s s-Atom">cv1min</span><span class="p">)),</span>

                                          <span class="nf">int</span><span class="p">((</span>

                                              <span class="s s-Atom">contours</span><span class="p">.</span><span class="s s-Atom">points</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="s s-Atom">cv2min</span><span class="p">)</span><span class="o">*</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res/</span><span class="p">(</span><span class="s s-Atom">cv2max</span><span class="o">-</span><span class="s s-Atom">cv2min</span><span class="p">)),</span>

                                          <span class="nf">int</span><span class="p">((</span><span class="s s-Atom">contours</span><span class="p">.</span><span class="s s-Atom">points</span><span class="p">[</span><span class="s s-Atom">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="s s-Atom">cv3min</span><span class="p">)</span><span class="o">*</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res/</span><span class="p">(</span><span class="s s-Atom">cv3max</span><span class="o">-</span><span class="s s-Atom">cv3min</span><span class="p">))])</span>

            <span class="s s-Atom">#</span> <span class="c1">%% Visualization</span>

            <span class="s s-Atom">pv</span><span class="p">.</span><span class="nf">set_plot_theme</span><span class="p">(</span><span class="s s-Atom">&#39;document&#39;</span><span class="p">)</span>

            <span class="s s-Atom">p</span> <span class="o">=</span> <span class="s s-Atom">pv</span><span class="p">.</span><span class="nv">Plotter</span><span class="p">()</span>

            <span class="s s-Atom">p</span><span class="p">.</span><span class="nf">add_mesh</span><span class="p">(</span><span class="s s-Atom">contours</span><span class="p">,</span> <span class="s s-Atom">scalars</span><span class="o">=</span><span class="s s-Atom">fescolors</span><span class="p">,</span> <span class="s s-Atom">opacity</span><span class="o">=</span><span class="s s-Atom">opacity</span><span class="p">,</span>

                       <span class="s s-Atom">cmap</span><span class="o">=</span><span class="s s-Atom">color_map</span><span class="p">,</span> <span class="s s-Atom">show_scalar_bar</span><span class="o">=</span><span class="nv">False</span><span class="p">,</span> <span class="s s-Atom">interpolate_before_map</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span>

            <span class="s s-Atom">p</span><span class="p">.</span><span class="nf">show_grid</span><span class="p">(</span><span class="s s-Atom">xlabel</span><span class="o">=</span><span class="s s-Atom">xlabel</span><span class="p">,</span> <span class="s s-Atom">ylabel</span><span class="o">=</span><span class="s s-Atom">ylabel</span><span class="p">,</span> <span class="s s-Atom">zlabel</span><span class="o">=</span><span class="s s-Atom">zlabel</span><span class="p">)</span>

            <span class="s s-Atom">p</span><span class="p">.</span><span class="nf">add_point_labels</span><span class="p">(</span><span class="s s-Atom">min_pv</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

                               <span class="s s-Atom">show_points</span><span class="o">=</span><span class="s s-Atom">show_points</span><span class="p">,</span> <span class="s s-Atom">always_visible</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span>

                               <span class="s s-Atom">point_color=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s s-Atom">point_size</span><span class="o">=</span><span class="s s-Atom">point_size</span><span class="p">,</span>

                               <span class="s s-Atom">font_size</span><span class="o">=</span><span class="s s-Atom">label_size</span><span class="p">,</span> <span class="s s-Atom">shape</span><span class="o">=</span><span class="nv">None</span><span class="p">)</span>

            <span class="s s-Atom">p</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">png_name</span> <span class="p">!</span><span class="o">=</span> <span class="nv">None</span><span class="o">:</span>

            <span class="s s-Atom">plt</span><span class="p">.</span><span class="nf">savefig</span><span class="p">(</span><span class="s s-Atom">png_name</span><span class="p">)</span>

    <span class="s s-Atom">def</span> <span class="nf">make_gif</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">gif_name=</span><span class="s2">&quot;FES.gif&quot;</span><span class="p">,</span> <span class="s s-Atom">cmap=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span>

                 <span class="s s-Atom">xlabel</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">ylabel</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">zlabel</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">label_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="s s-Atom">image_size</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>

                 <span class="s s-Atom">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="s s-Atom">levels</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">show_points</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span> <span class="s s-Atom">point_size</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="s s-Atom">frames</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span><span class="o">:</span>

        <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        Equvivalent to Fes.make_gif()</span>

<span class="s2">        &quot;&quot;&quot;</span>

        <span class="s s-Atom">try</span><span class="p">:</span>

            <span class="s s-Atom">import</span> <span class="s s-Atom">pyvista</span> <span class="s s-Atom">as</span> <span class="s s-Atom">pv</span>

        <span class="nf">except</span> <span class="p">(</span><span class="nv">ImportError</span><span class="p">,</span> <span class="nv">ModuleNotFoundError</span><span class="p">)</span> <span class="s s-Atom">as</span> <span class="s s-Atom">e</span><span class="p">:</span>

            <span class="nf">print</span><span class="p">(</span><span class="s s-Atom">e</span><span class="p">)</span>

            <span class="s s-Atom">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span> <span class="o">==</span> <span class="mi">3</span><span class="o">:</span>

            <span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv2min</span><span class="p">,</span> <span class="s s-Atom">cv3min</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="s s-Atom">cv1max</span><span class="p">,</span> <span class="s s-Atom">cv2max</span><span class="p">,</span> <span class="s s-Atom">cv3max</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="nb">val</span><span class="s s-Atom">ues</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>

                                 <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">),</span> <span class="s s-Atom">num</span><span class="o">=</span><span class="s s-Atom">frames</span><span class="p">)</span>

            <span class="s s-Atom">grid</span> <span class="o">=</span> <span class="s s-Atom">pv</span><span class="p">.</span><span class="nv">UniformGrid</span><span class="p">(</span>

                <span class="s s-Atom">dimensions=</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">),</span>

                <span class="s s-Atom">spacing=</span><span class="p">((</span><span class="s s-Atom">cv1max</span><span class="o">-</span><span class="s s-Atom">cv1min</span><span class="p">)</span><span class="o">/</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">cv2max</span><span class="o">-</span><span class="s s-Atom">cv2min</span><span class="p">)</span> <span class="o">/</span>

                         <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">cv3max</span><span class="o">-</span><span class="s s-Atom">cv3min</span><span class="p">)</span><span class="o">/</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">),</span>

                <span class="s s-Atom">origin=</span><span class="p">(</span><span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv2min</span><span class="p">,</span> <span class="s s-Atom">cv3min</span><span class="p">),</span>

            <span class="p">)</span>

            <span class="s s-Atom">grid</span><span class="p">[</span><span class="s2">&quot;vol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">.</span><span class="nf">ravel</span><span class="p">(</span><span class="s s-Atom">order=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

            <span class="s s-Atom">surface</span> <span class="o">=</span> <span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">contour</span><span class="p">(</span><span class="nb">val</span><span class="s s-Atom">ues</span><span class="p">[</span><span class="o">:</span><span class="mi">1</span><span class="p">])</span>

            <span class="s s-Atom">surfaces</span> <span class="o">=</span> <span class="p">[</span><span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">contour</span><span class="p">([</span><span class="s s-Atom">v</span><span class="p">])</span> <span class="s s-Atom">for</span> <span class="s s-Atom">v</span> <span class="s s-Atom">in</span> <span class="nb">val</span><span class="s s-Atom">ues</span><span class="p">]</span>

            <span class="s s-Atom">surface</span> <span class="o">=</span> <span class="s s-Atom">surfaces</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">copy</span><span class="p">()</span>

            <span class="s s-Atom">pv</span><span class="p">.</span><span class="nf">set_plot_theme</span><span class="p">(</span><span class="s s-Atom">&#39;document&#39;</span><span class="p">)</span>

            <span class="s s-Atom">plotter</span> <span class="o">=</span> <span class="s s-Atom">pv</span><span class="p">.</span><span class="nv">Plotter</span><span class="p">(</span><span class="s s-Atom">off_screen</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span>

            <span class="s s-Atom">#</span> <span class="nv">Open</span> <span class="s s-Atom">a</span> <span class="s s-Atom">movie</span> <span class="s s-Atom">file</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">open_gif</span><span class="p">(</span><span class="s s-Atom">gif_name</span><span class="p">)</span>

            <span class="s s-Atom">#</span> <span class="nv">Add</span> <span class="s s-Atom">initial</span> <span class="s s-Atom">mesh</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">add_mesh</span><span class="p">(</span>

                <span class="s s-Atom">surface</span><span class="p">,</span>

                <span class="s s-Atom">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>

                <span class="s s-Atom">clim</span><span class="o">=</span><span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">get_data_range</span><span class="p">(),</span>

                <span class="s s-Atom">show_scalar_bar</span><span class="o">=</span><span class="nv">False</span><span class="p">,</span>

                <span class="s s-Atom">cmap=</span><span class="s2">&quot;jet&quot;</span>

            <span class="p">)</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">add_mesh</span><span class="p">(</span><span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">outline_corners</span><span class="p">(),</span> <span class="s s-Atom">color=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">xlabel</span> <span class="o">==</span> <span class="nv">None</span> <span class="s s-Atom">and</span> <span class="s s-Atom">ylabel</span> <span class="o">==</span> <span class="nv">None</span> <span class="s s-Atom">and</span> <span class="s s-Atom">zlabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">show_grid</span><span class="p">(</span>

                    <span class="s s-Atom">xlabel</span><span class="o">=</span><span class="s s-Atom">f</span><span class="s2">&quot;CV1 - {self.cv_name[0]}&quot;</span><span class="p">,</span> <span class="s s-Atom">ylabel</span><span class="o">=</span><span class="s s-Atom">f</span><span class="s2">&quot;CV2 - {self.cv_name[1]}&quot;</span><span class="p">,</span> <span class="s s-Atom">zlabel</span><span class="o">=</span><span class="s s-Atom">f</span><span class="s2">&quot;CV3 - {self.cv_name[2]}&quot;</span><span class="p">)</span>

            <span class="s s-Atom">else</span><span class="p">:</span>

                <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">show_grid</span><span class="p">(</span><span class="s s-Atom">xlabel</span><span class="o">=</span><span class="s s-Atom">xlabel</span><span class="p">,</span> <span class="s s-Atom">ylabel</span><span class="o">=</span><span class="s s-Atom">ylabel</span><span class="p">,</span> <span class="s s-Atom">zlabel</span><span class="o">=</span><span class="s s-Atom">zlabel</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">show_points</span><span class="o">:</span>

                <span class="s s-Atom">min_ar</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">5</span><span class="o">:</span><span class="mi">8</span><span class="p">].</span><span class="nb">val</span><span class="s s-Atom">ues</span>

                <span class="s s-Atom">min_ar</span> <span class="o">=</span> <span class="s s-Atom">min_ar</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="s s-Atom">float32</span><span class="p">)</span>

                <span class="s s-Atom">min_pv</span> <span class="o">=</span> <span class="s s-Atom">pv</span><span class="p">.</span><span class="nv">PolyData</span><span class="p">(</span><span class="s s-Atom">min_ar</span><span class="p">)</span>

                <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">add_point_labels</span><span class="p">(</span><span class="s s-Atom">min_pv</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

                                         <span class="s s-Atom">show_points</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span> <span class="s s-Atom">always_visible</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span>

                                         <span class="s s-Atom">pickable</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span> <span class="s s-Atom">point_color=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>

                                         <span class="s s-Atom">point_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="s s-Atom">font_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="s s-Atom">shape</span><span class="o">=</span><span class="nv">None</span><span class="p">)</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">set_background</span><span class="p">(</span><span class="s s-Atom">&#39;white&#39;</span><span class="p">)</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">show</span><span class="p">(</span><span class="s s-Atom">auto_close</span><span class="o">=</span><span class="nv">False</span><span class="p">)</span>

            <span class="s s-Atom">#</span> <span class="nv">Run</span> <span class="s s-Atom">through</span> <span class="s s-Atom">each</span> <span class="s s-Atom">frame</span>

            <span class="s s-Atom">for</span> <span class="s s-Atom">surf</span> <span class="s s-Atom">in</span> <span class="s s-Atom">surfaces</span><span class="p">:</span>

                <span class="s s-Atom">surface</span><span class="p">.</span><span class="nf">copy_from</span><span class="p">(</span><span class="s s-Atom">surf</span><span class="p">)</span>

                <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">write_frame</span><span class="p">()</span>  <span class="s s-Atom">#</span> <span class="nv">Write</span> <span class="s s-Atom">this</span> <span class="s s-Atom">frame</span>

            <span class="s s-Atom">#</span> <span class="nv">Run</span> <span class="s s-Atom">through</span> <span class="s s-Atom">backwards</span>

            <span class="s s-Atom">for</span> <span class="s s-Atom">surf</span> <span class="s s-Atom">in</span> <span class="s s-Atom">surfaces</span><span class="p">[</span><span class="o">::-</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span>

                <span class="s s-Atom">surface</span><span class="p">.</span><span class="nf">copy_from</span><span class="p">(</span><span class="s s-Atom">surf</span><span class="p">)</span>

                <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">write_frame</span><span class="p">()</span>  <span class="s s-Atom">#</span> <span class="nv">Write</span> <span class="s s-Atom">this</span> <span class="s s-Atom">frame</span>

            <span class="s s-Atom">#</span> <span class="nv">Be</span> <span class="s s-Atom">sure</span> <span class="s s-Atom">to</span> <span class="s s-Atom">close</span> <span class="s s-Atom">the</span> <span class="s s-Atom">plotter</span> <span class="s s-Atom">when</span> <span class="s s-Atom">finished</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

        <span class="s s-Atom">else</span><span class="p">:</span>

            <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;Error: gif_plot is only available for FES with 3 CVs.&quot;</span><span class="p">)</span>
</code></pre></div>

</details>
<hr />
<h4 id="methods">Methods</h4>
<h4 id="findminima">findminima</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">findminima</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nbins</span><span class="o">=</span><span class="mi">8</span>
<span class="p">)</span>
</code></pre></div>

<p>Method for finding local minima on FES.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>fes</td>
<td>Fes</td>
<td>The Fes object to find the minima on.</td>
<td>None</td>
</tr>
<tr>
<td>nbins</td>
<td>int, default=8</td>
<td>The number of bins used to divide the FES.</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">findminima</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">nbins</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Method for finding local minima on FES.</span>

<span class="ss">        Args:</span>

<span class="ss">            fes (Fes): The Fes object to find the minima on.</span>

<span class="ss">            nbins (int, default=8): The number of bins used to divide the FES.</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">cv_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_min</span>

<span class="w">        </span><span class="n">cv_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_max</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nc">int</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nl">nbins</span><span class="p">:</span>

<span class="w">            </span><span class="n">nbins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">int</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span>

<span class="w">                </span><span class="n">f</span><span class="ss">&quot;Number of bins must be an integer, it will be set to {nbins}.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">nbins</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;Error: Resolution of FES must be divisible by number of bins.&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">None</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">nbins</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="o">/</span><span class="mi">2</span><span class="err">:</span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;Error: Number of bins is too high.&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">None</span>

<span class="w">        </span><span class="n">bin_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">int</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="o">/</span><span class="n">nbins</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">ndindex</span><span class="p">(</span><span class="n">tuple</span><span class="p">(</span><span class="o">[</span><span class="n">nbins</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cvs</span><span class="p">))</span><span class="err">:</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">bin</span><span class="w"> </span><span class="n">number</span>

<span class="w">            </span><span class="n">_fes_slice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tuple</span><span class="p">(</span>

<span class="w">                </span><span class="n">slice</span><span class="p">(</span>

<span class="w">                    </span><span class="k">index</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">bin_size</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">index</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">bin_size</span>

<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cvs</span><span class="p">)</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="n">fes_slice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">fes</span><span class="o">[</span><span class="n">_fes_slice</span><span class="o">]</span>

<span class="w">            </span><span class="n">bin_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">fes_slice</span><span class="p">)</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">indexes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="n">minimum</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">bin</span>

<span class="w">            </span><span class="n">bin_min_arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">unravel_index</span><span class="p">(</span>

<span class="w">                </span><span class="n">np</span><span class="p">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">fes_slice</span><span class="p">),</span><span class="w"> </span><span class="n">fes_slice</span><span class="p">.</span><span class="n">shape</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">indexes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">minima</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">original</span><span class="w"> </span><span class="n">fes</span><span class="w"> </span><span class="p">(</span><span class="n">indexes</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="w">            </span><span class="n">min_cv_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="o">[</span>

<span class="n">                bin_min_arg[i</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">index</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">bin_size</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cvs</span><span class="p">)</span>

<span class="w">            </span><span class="err">]</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="o">=</span><span class="nc">int</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">bin_min_arg</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="o">=</span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="ow">all</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="err">\</span>

<span class="w">                    </span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">bin_min_arg</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="o">=</span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">bin_size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="ow">all</span><span class="p">()</span><span class="err">:</span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">minima</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">bin</span>

<span class="w">                </span><span class="n">min_cv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(((</span><span class="n">min_cv_b</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">cv_max</span><span class="o">-</span><span class="n">cv_min</span><span class="p">))</span><span class="o">+</span><span class="n">cv_min</span>

<span class="w">                </span><span class="n">local_minima</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">(</span><span class="o">[</span>

<span class="n">                    [np.round(bin_min, 6)</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">min_cv_b</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="n">min_cv</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span>

<span class="w">                </span><span class="err">]</span><span class="p">)</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                    </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">local_minima</span>

<span class="w">                </span><span class="k">else</span><span class="err">:</span>

<span class="w">                    </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">,</span><span class="w"> </span><span class="n">local_minima</span><span class="p">))</span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">minima</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">bin</span>

<span class="w">                </span><span class="n">around</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tuple</span><span class="p">(</span><span class="o">[</span><span class="n">3</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cvs</span><span class="p">))</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="n">product_index</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">product</span><span class="p">(</span><span class="o">*[</span><span class="n">range(3)</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cvs</span><span class="p">)</span><span class="err">:</span>

<span class="w">                    </span><span class="n">converted_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">product_index</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="o">=</span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">\</span>

<span class="w">                        </span><span class="n">np</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">min_cv_b</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="o">=</span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>

<span class="w">                    </span><span class="n">converted_index</span><span class="o">[</span><span class="n">self.periodic</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span>

<span class="w">                        </span><span class="n">converted_index</span><span class="o">[</span><span class="n">self.periodic</span><span class="o">]</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">res</span>

<span class="w">                    </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">where</span><span class="p">(</span>

<span class="w">                        </span><span class="p">(</span><span class="n">converted_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">converted_index</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="w">                    </span><span class="p">)</span><span class="o">[</span><span class="n">0</span><span class="o">]</span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span>

<span class="w">                        </span><span class="n">around</span><span class="o">[</span><span class="n">product_index</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">inf</span>

<span class="w">                    </span><span class="n">elif</span><span class="w"> </span><span class="n">product_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tuple</span><span class="p">(</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cvs</span><span class="p">)</span><span class="err">:</span>

<span class="w">                        </span><span class="n">around</span><span class="o">[</span><span class="n">product_index</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">inf</span>

<span class="w">                    </span><span class="k">else</span><span class="err">:</span>

<span class="w">                        </span><span class="n">around</span><span class="o">[</span><span class="n">product_index</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">fes</span><span class="o">[</span><span class="n">tuple(</span>

<span class="n">                            converted_index)</span><span class="o">]</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">around</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">bin_min</span><span class="p">).</span><span class="ow">all</span><span class="p">()</span><span class="err">:</span>

<span class="w">                    </span><span class="n">min_cv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(((</span><span class="n">min_cv_b</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">cv_max</span><span class="o">-</span><span class="n">cv_min</span><span class="p">))</span><span class="o">+</span><span class="n">cv_min</span>

<span class="w">                    </span><span class="n">local_minima</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">(</span><span class="o">[</span>

<span class="n">                        [np.round(bin_min, 6)</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">min_cv_b</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="n">min_cv</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span>

<span class="w">                    </span><span class="err">]</span><span class="p">)</span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                        </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">local_minima</span>

<span class="w">                    </span><span class="k">else</span><span class="err">:</span>

<span class="w">                        </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">,</span><span class="w"> </span><span class="n">local_minima</span><span class="p">))</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;No minima found.&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">None</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="o">[</span><span class="n">self.minima[:, 0</span><span class="o">]</span><span class="p">.</span><span class="n">argsort</span><span class="p">()</span><span class="err">]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">shape</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span>

<span class="w">                </span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">shape</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="o">=</span><span class="nc">int</span><span class="p">),</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span>

<span class="w">            </span><span class="p">))</span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">column_stack</span><span class="p">((</span>

<span class="w">                </span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">shape</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="o">=</span><span class="nc">int</span><span class="p">),</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span>

<span class="w">            </span><span class="p">))</span>

<span class="w">        </span><span class="n">minima_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span>

<span class="w">            </span><span class="n">np</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">),</span>

<span class="w">            </span><span class="n">columns</span><span class="o">=[</span><span class="n">&quot;Minimum&quot;, &quot;free energy&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">+</span>

<span class="w">            </span><span class="o">[</span><span class="n">f&quot;CV{i+1}bin&quot; for i in range(self.cvs)</span><span class="o">]</span><span class="w"> </span><span class="o">+</span>

<span class="w">            </span><span class="o">[</span><span class="n">f&quot;CV{i+1} - {self.cv_name[i</span><span class="o">]</span><span class="err">}</span><span class="ss">&quot; for i in range(self.cvs)]</span>

<span class="ss">        )</span>

<span class="ss">        minima_df[&quot;</span><span class="n">Minimum</span><span class="ss">&quot;] = minima_df[&quot;</span><span class="n">Minimum</span><span class="err">&quot;]</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="nc">int</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">minima_df</span>
</code></pre></div>

</details>
<h4 id="make_gif">make_gif</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">make_gif</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">gif_name</span><span class="o">=</span><span class="s1">&#39;FES.gif&#39;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">zlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">label_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">image_size</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">show_points</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">point_size</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
    <span class="n">frames</span><span class="o">=</span><span class="mi">64</span>
<span class="p">)</span>
</code></pre></div>

<p>Equvivalent to Fes.make_gif()</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code>    <span class="s s-Atom">def</span> <span class="nf">make_gif</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">gif_name=</span><span class="s2">&quot;FES.gif&quot;</span><span class="p">,</span> <span class="s s-Atom">cmap=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span>

                 <span class="s s-Atom">xlabel</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">ylabel</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">zlabel</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">label_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="s s-Atom">image_size</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>

                 <span class="s s-Atom">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="s s-Atom">levels</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">show_points</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span> <span class="s s-Atom">point_size</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="s s-Atom">frames</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span><span class="o">:</span>

        <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        Equvivalent to Fes.make_gif()</span>

<span class="s2">        &quot;&quot;&quot;</span>

        <span class="s s-Atom">try</span><span class="p">:</span>

            <span class="s s-Atom">import</span> <span class="s s-Atom">pyvista</span> <span class="s s-Atom">as</span> <span class="s s-Atom">pv</span>

        <span class="nf">except</span> <span class="p">(</span><span class="nv">ImportError</span><span class="p">,</span> <span class="nv">ModuleNotFoundError</span><span class="p">)</span> <span class="s s-Atom">as</span> <span class="s s-Atom">e</span><span class="p">:</span>

            <span class="nf">print</span><span class="p">(</span><span class="s s-Atom">e</span><span class="p">)</span>

            <span class="s s-Atom">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cvs</span> <span class="o">==</span> <span class="mi">3</span><span class="o">:</span>

            <span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv2min</span><span class="p">,</span> <span class="s s-Atom">cv3min</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_min</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="s s-Atom">cv1max</span><span class="p">,</span> <span class="s s-Atom">cv2max</span><span class="p">,</span> <span class="s s-Atom">cv3max</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">cv_max</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="nb">val</span><span class="s s-Atom">ues</span> <span class="o">=</span> <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>

                                 <span class="s s-Atom">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">),</span> <span class="s s-Atom">num</span><span class="o">=</span><span class="s s-Atom">frames</span><span class="p">)</span>

            <span class="s s-Atom">grid</span> <span class="o">=</span> <span class="s s-Atom">pv</span><span class="p">.</span><span class="nv">UniformGrid</span><span class="p">(</span>

                <span class="s s-Atom">dimensions=</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">),</span>

                <span class="s s-Atom">spacing=</span><span class="p">((</span><span class="s s-Atom">cv1max</span><span class="o">-</span><span class="s s-Atom">cv1min</span><span class="p">)</span><span class="o">/</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">cv2max</span><span class="o">-</span><span class="s s-Atom">cv2min</span><span class="p">)</span> <span class="o">/</span>

                         <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">cv3max</span><span class="o">-</span><span class="s s-Atom">cv3min</span><span class="p">)</span><span class="o">/</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">res</span><span class="p">),</span>

                <span class="s s-Atom">origin=</span><span class="p">(</span><span class="s s-Atom">cv1min</span><span class="p">,</span> <span class="s s-Atom">cv2min</span><span class="p">,</span> <span class="s s-Atom">cv3min</span><span class="p">),</span>

            <span class="p">)</span>

            <span class="s s-Atom">grid</span><span class="p">[</span><span class="s2">&quot;vol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">fes</span><span class="p">.</span><span class="nf">ravel</span><span class="p">(</span><span class="s s-Atom">order=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

            <span class="s s-Atom">surface</span> <span class="o">=</span> <span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">contour</span><span class="p">(</span><span class="nb">val</span><span class="s s-Atom">ues</span><span class="p">[</span><span class="o">:</span><span class="mi">1</span><span class="p">])</span>

            <span class="s s-Atom">surfaces</span> <span class="o">=</span> <span class="p">[</span><span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">contour</span><span class="p">([</span><span class="s s-Atom">v</span><span class="p">])</span> <span class="s s-Atom">for</span> <span class="s s-Atom">v</span> <span class="s s-Atom">in</span> <span class="nb">val</span><span class="s s-Atom">ues</span><span class="p">]</span>

            <span class="s s-Atom">surface</span> <span class="o">=</span> <span class="s s-Atom">surfaces</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">copy</span><span class="p">()</span>

            <span class="s s-Atom">pv</span><span class="p">.</span><span class="nf">set_plot_theme</span><span class="p">(</span><span class="s s-Atom">&#39;document&#39;</span><span class="p">)</span>

            <span class="s s-Atom">plotter</span> <span class="o">=</span> <span class="s s-Atom">pv</span><span class="p">.</span><span class="nv">Plotter</span><span class="p">(</span><span class="s s-Atom">off_screen</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span>

            <span class="s s-Atom">#</span> <span class="nv">Open</span> <span class="s s-Atom">a</span> <span class="s s-Atom">movie</span> <span class="s s-Atom">file</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">open_gif</span><span class="p">(</span><span class="s s-Atom">gif_name</span><span class="p">)</span>

            <span class="s s-Atom">#</span> <span class="nv">Add</span> <span class="s s-Atom">initial</span> <span class="s s-Atom">mesh</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">add_mesh</span><span class="p">(</span>

                <span class="s s-Atom">surface</span><span class="p">,</span>

                <span class="s s-Atom">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>

                <span class="s s-Atom">clim</span><span class="o">=</span><span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">get_data_range</span><span class="p">(),</span>

                <span class="s s-Atom">show_scalar_bar</span><span class="o">=</span><span class="nv">False</span><span class="p">,</span>

                <span class="s s-Atom">cmap=</span><span class="s2">&quot;jet&quot;</span>

            <span class="p">)</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">add_mesh</span><span class="p">(</span><span class="s s-Atom">grid</span><span class="p">.</span><span class="nf">outline_corners</span><span class="p">(),</span> <span class="s s-Atom">color=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">xlabel</span> <span class="o">==</span> <span class="nv">None</span> <span class="s s-Atom">and</span> <span class="s s-Atom">ylabel</span> <span class="o">==</span> <span class="nv">None</span> <span class="s s-Atom">and</span> <span class="s s-Atom">zlabel</span> <span class="o">==</span> <span class="nv">None</span><span class="o">:</span>

                <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">show_grid</span><span class="p">(</span>

                    <span class="s s-Atom">xlabel</span><span class="o">=</span><span class="s s-Atom">f</span><span class="s2">&quot;CV1 - {self.cv_name[0]}&quot;</span><span class="p">,</span> <span class="s s-Atom">ylabel</span><span class="o">=</span><span class="s s-Atom">f</span><span class="s2">&quot;CV2 - {self.cv_name[1]}&quot;</span><span class="p">,</span> <span class="s s-Atom">zlabel</span><span class="o">=</span><span class="s s-Atom">f</span><span class="s2">&quot;CV3 - {self.cv_name[2]}&quot;</span><span class="p">)</span>

            <span class="s s-Atom">else</span><span class="p">:</span>

                <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">show_grid</span><span class="p">(</span><span class="s s-Atom">xlabel</span><span class="o">=</span><span class="s s-Atom">xlabel</span><span class="p">,</span> <span class="s s-Atom">ylabel</span><span class="o">=</span><span class="s s-Atom">ylabel</span><span class="p">,</span> <span class="s s-Atom">zlabel</span><span class="o">=</span><span class="s s-Atom">zlabel</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">show_points</span><span class="o">:</span>

                <span class="s s-Atom">min_ar</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">5</span><span class="o">:</span><span class="mi">8</span><span class="p">].</span><span class="nb">val</span><span class="s s-Atom">ues</span>

                <span class="s s-Atom">min_ar</span> <span class="o">=</span> <span class="s s-Atom">min_ar</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="s s-Atom">np</span><span class="p">.</span><span class="s s-Atom">float32</span><span class="p">)</span>

                <span class="s s-Atom">min_pv</span> <span class="o">=</span> <span class="s s-Atom">pv</span><span class="p">.</span><span class="nv">PolyData</span><span class="p">(</span><span class="s s-Atom">min_ar</span><span class="p">)</span>

                <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">add_point_labels</span><span class="p">(</span><span class="s s-Atom">min_pv</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">minima</span><span class="p">.</span><span class="s s-Atom">iloc</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

                                         <span class="s s-Atom">show_points</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span> <span class="s s-Atom">always_visible</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span>

                                         <span class="s s-Atom">pickable</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span> <span class="s s-Atom">point_color=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>

                                         <span class="s s-Atom">point_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="s s-Atom">font_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="s s-Atom">shape</span><span class="o">=</span><span class="nv">None</span><span class="p">)</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">set_background</span><span class="p">(</span><span class="s s-Atom">&#39;white&#39;</span><span class="p">)</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">show</span><span class="p">(</span><span class="s s-Atom">auto_close</span><span class="o">=</span><span class="nv">False</span><span class="p">)</span>

            <span class="s s-Atom">#</span> <span class="nv">Run</span> <span class="s s-Atom">through</span> <span class="s s-Atom">each</span> <span class="s s-Atom">frame</span>

            <span class="s s-Atom">for</span> <span class="s s-Atom">surf</span> <span class="s s-Atom">in</span> <span class="s s-Atom">surfaces</span><span class="p">:</span>

                <span class="s s-Atom">surface</span><span class="p">.</span><span class="nf">copy_from</span><span class="p">(</span><span class="s s-Atom">surf</span><span class="p">)</span>

                <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">write_frame</span><span class="p">()</span>  <span class="s s-Atom">#</span> <span class="nv">Write</span> <span class="s s-Atom">this</span> <span class="s s-Atom">frame</span>

            <span class="s s-Atom">#</span> <span class="nv">Run</span> <span class="s s-Atom">through</span> <span class="s s-Atom">backwards</span>

            <span class="s s-Atom">for</span> <span class="s s-Atom">surf</span> <span class="s s-Atom">in</span> <span class="s s-Atom">surfaces</span><span class="p">[</span><span class="o">::-</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span>

                <span class="s s-Atom">surface</span><span class="p">.</span><span class="nf">copy_from</span><span class="p">(</span><span class="s s-Atom">surf</span><span class="p">)</span>

                <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">write_frame</span><span class="p">()</span>  <span class="s s-Atom">#</span> <span class="nv">Write</span> <span class="s s-Atom">this</span> <span class="s s-Atom">frame</span>

            <span class="s s-Atom">#</span> <span class="nv">Be</span> <span class="s s-Atom">sure</span> <span class="s s-Atom">to</span> <span class="s s-Atom">close</span> <span class="s s-Atom">the</span> <span class="s s-Atom">plotter</span> <span class="s s-Atom">when</span> <span class="s s-Atom">finished</span>

            <span class="s s-Atom">plotter</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

        <span class="s s-Atom">else</span><span class="p">:</span>

            <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;Error: gif_plot is only available for FES with 3 CVs.&quot;</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="plot">plot</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">png_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">contours</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">contours_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">aspect</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">cmap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;jet&#39;</span><span class="p">,</span>
    <span class="n">energy_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;kJ/mol&#39;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">zlabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">label_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
    <span class="n">image_size</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
    <span class="n">color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vmin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">vmax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">levels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show_points</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">point_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="p">)</span>
</code></pre></div>

<p>Function used to visualize the FES objects with the positions of local minima shown as letters on the graph.</p>
<p>Usage:</p>
<div class="codehilite"><pre><span></span><code><span class="n">minima</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>png_name</td>
<td>str</td>
<td>If provided, the picture of the FES will be saved under this name to the current working directory.</td>
<td>None</td>
</tr>
<tr>
<td>contours</td>
<td>bool, default=True</td>
<td>Specifies whether contours should be shown on the 2D FES.</td>
<td>None</td>
</tr>
<tr>
<td>contours_spacing</td>
<td>float, default=0.0</td>
<td>When a positive number is set, it will be used as the spacing for contours on the 2D FES.                 Otherwise, if contours=True, there will be five equally spaced contour levels.</td>
<td>None</td>
</tr>
<tr>
<td>aspect</td>
<td>float, default=1.0</td>
<td>The aspect ratio of the graph. Works with 1D and 2D FES.</td>
<td>None</td>
</tr>
<tr>
<td>cmap</td>
<td>str, default="jet"</td>
<td>The Matplotlib colormap used to color the 2D or 3D FES.</td>
<td>None</td>
</tr>
<tr>
<td>energy_unit</td>
<td>str, default="kJ/mol"</td>
<td>A string used in the description of the colorbar.</td>
<td>None</td>
</tr>
<tr>
<td>xlabel, ylabel, zlabel</td>
<td>str</td>
<td>If provided, they will be used as labels for the graphs.</td>
<td>None</td>
</tr>
<tr>
<td>label_size</td>
<td>int, default=12</td>
<td>The size of text in labels.</td>
<td>None</td>
</tr>
<tr>
<td>image_size</td>
<td>List[int], default=[10,7]</td>
<td>The width and height of the picture.</td>
<td>None</td>
</tr>
<tr>
<td>color</td>
<td>str</td>
<td>The name of the color in Matplotlib.                 If set, the color will be used for the letters.                 If not set, the color should be automatically either black or white,                 depending on what will be more visible on the given place on the FES with the given colormap (for 2D FES).</td>
<td>None</td>
</tr>
<tr>
<td>vmin</td>
<td>float, default=0</td>
<td>The lower bound for the colormap on the 2D FES.</td>
<td>None</td>
</tr>
<tr>
<td>vmax</td>
<td>float</td>
<td>The upper bound for the colormap on the 2D FES.</td>
<td>None</td>
</tr>
<tr>
<td>opacity</td>
<td>float, default=0.2</td>
<td>A number between 0 and 1 representing the opacity of isosurfaces in the 3D FES.</td>
<td>None</td>
</tr>
<tr>
<td>levels</td>
<td>List[float]</td>
<td>A list of free energy values for isosurfaces on the 3D FES.                 If not provided, default values from the contours parameters will be used instead.</td>
<td>None</td>
</tr>
<tr>
<td>show_points</td>
<td>bool, default=True</td>
<td>Specifies whether points should be visualized instead of just the letters.                 Only applicable for 3D FES.</td>
<td>None</td>
</tr>
<tr>
<td>point_size</td>
<td>float, default=4.0</td>
<td>The size of points if show_points=True.</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="nl">png_name</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">contours</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">,</span>

<span class="w">        </span><span class="nl">contours_spacing</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span>

<span class="w">        </span><span class="nl">aspect</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>

<span class="w">        </span><span class="nl">cmap</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;jet&quot;</span><span class="p">,</span>

<span class="w">        </span><span class="nl">energy_unit</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;kJ/mol&quot;</span><span class="p">,</span>

<span class="w">        </span><span class="nl">xlabel</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">ylabel</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">zlabel</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">label_size</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>

<span class="w">        </span><span class="nl">image_size</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">[</span><span class="n">int</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">10, 7</span><span class="o">]</span><span class="p">,</span>

<span class="w">        </span><span class="nl">color</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">vmin</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>

<span class="w">        </span><span class="nl">vmax</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">float</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">opacity</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.2</span><span class="p">,</span>

<span class="w">        </span><span class="nl">levels</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">List[float</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">show_points</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">,</span>

<span class="w">        </span><span class="nl">point_size</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Function used to visualize the FES objects with the positions of local minima shown as letters on the graph.</span>

<span class="ss">        Usage:</span>

<span class="ss">        ```python</span>

<span class="ss">        minima.plot()</span>

<span class="ss">        ```</span>

<span class="ss">        Args:</span>

<span class="ss">            png_name (str, optional): \</span>

<span class="ss">                If provided, the picture of the FES will be saved under this name to the current working directory.</span>

<span class="ss">            contours (bool, default=True): \</span>

<span class="ss">                Specifies whether contours should be shown on the 2D FES.</span>

<span class="ss">            contours_spacing (float, default=0.0): \</span>

<span class="ss">                When a positive number is set, it will be used as the spacing for contours on the 2D FES. \</span>

<span class="ss">                Otherwise, if contours=True, there will be five equally spaced contour levels.</span>

<span class="ss">            aspect (float, default=1.0): \</span>

<span class="ss">                The aspect ratio of the graph. Works with 1D and 2D FES.</span>

<span class="ss">            cmap (str, default=&quot;</span><span class="n">jet</span><span class="ss">&quot;): \</span>

<span class="ss">                The Matplotlib colormap used to color the 2D or 3D FES.</span>

<span class="ss">            energy_unit (str, default=&quot;</span><span class="n">kJ</span><span class="o">/</span><span class="n">mol</span><span class="ss">&quot;): \</span>

<span class="ss">                A string used in the description of the colorbar.</span>

<span class="ss">            xlabel, ylabel, zlabel (str, optional): \</span>

<span class="ss">                If provided, they will be used as labels for the graphs.</span>

<span class="ss">            label_size (int, default=12): The size of text in labels.</span>

<span class="ss">            image_size (List[int], default=[10,7]): The width and height of the picture.</span>

<span class="ss">            color (str, optional): \</span>

<span class="ss">                The name of the color in Matplotlib. \</span>

<span class="ss">                If set, the color will be used for the letters. \</span>

<span class="ss">                If not set, the color should be automatically either black or white, \</span>

<span class="ss">                depending on what will be more visible on the given place on the FES with the given colormap (for 2D FES).</span>

<span class="ss">            vmin (float, default=0): The lower bound for the colormap on the 2D FES.</span>

<span class="ss">            vmax (float, optional): The upper bound for the colormap on the 2D FES.</span>

<span class="ss">            opacity (float, default=0.2): \</span>

<span class="ss">                A number between 0 and 1 representing the opacity of isosurfaces in the 3D FES.</span>

<span class="ss">            levels (List[float], optional): \</span>

<span class="ss">                A list of free energy values for isosurfaces on the 3D FES. \</span>

<span class="ss">                If not provided, default values from the contours parameters will be used instead.</span>

<span class="ss">            show_points (bool, default=True): \</span>

<span class="ss">                Specifies whether points should be visualized instead of just the letters. \</span>

<span class="ss">                Only applicable for 3D FES.</span>

<span class="ss">            point_size (float, default=4.0): \</span>

<span class="ss">                The size of points if show_points=True.</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">import</span><span class="w"> </span><span class="n">matplotlib</span><span class="p">.</span><span class="n">pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">plt</span>

<span class="w">        </span><span class="n">import</span><span class="w"> </span><span class="n">matplotlib</span><span class="p">.</span><span class="n">cm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cm</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">vmax</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">addition</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">smaller</span><span class="w"> </span><span class="k">than</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="mi">3</span><span class="n">d</span><span class="w"> </span><span class="n">plot</span><span class="w"> </span><span class="n">stops</span><span class="w"> </span><span class="n">working</span><span class="p">.</span>

<span class="w">            </span><span class="n">vmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">fes</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.01</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">contours_spacing</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0</span><span class="err">:</span>

<span class="w">            </span><span class="n">contours_spacing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">vmax</span><span class="o">-</span><span class="n">vmin</span><span class="p">)</span><span class="o">/</span><span class="mf">5.0</span>

<span class="w">        </span><span class="n">color_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cm</span><span class="p">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>

<span class="w">        </span><span class="n">color_map</span><span class="p">.</span><span class="n">set_over</span><span class="p">(</span><span class="ss">&quot;white&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">color_map</span><span class="p">.</span><span class="n">set_under</span><span class="p">(</span><span class="ss">&quot;white&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">color_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">color_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cvs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">            </span><span class="n">cv1min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_min</span><span class="o">[</span><span class="n">0</span><span class="o">]</span>

<span class="w">            </span><span class="n">cv1max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_max</span><span class="o">[</span><span class="n">0</span><span class="o">]</span>

<span class="w">            </span><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">image_size</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">image_size</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">))</span>

<span class="w">            </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cv1min</span><span class="p">,</span><span class="w"> </span><span class="n">cv1max</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="p">)</span>

<span class="w">            </span><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">fes</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">color_set</span><span class="p">:</span>

<span class="w">                </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;black&quot;</span>

<span class="w">            </span><span class="n">ferange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">fes</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">fes</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">shape</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">                </span><span class="n">plt</span><span class="p">.</span><span class="nc">text</span><span class="p">(</span><span class="nc">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">0, 3</span><span class="o">]</span><span class="p">),</span><span class="w"> </span><span class="nc">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">0, 1</span><span class="o">]</span><span class="p">)</span><span class="o">+</span><span class="n">ferange</span><span class="o">*</span><span class="mf">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">0, 0</span><span class="o">]</span><span class="p">,</span>

<span class="w">                         </span><span class="n">fontsize</span><span class="o">=</span><span class="n">label_size</span><span class="p">,</span><span class="w"> </span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>

<span class="w">                         </span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

<span class="w">            </span><span class="n">elif</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">shape</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">:, 0</span><span class="o">]</span><span class="p">))</span><span class="err">:</span>

<span class="w">                    </span><span class="n">plt</span><span class="p">.</span><span class="nc">text</span><span class="p">(</span><span class="nc">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">m, 3</span><span class="o">]</span><span class="p">),</span><span class="w"> </span><span class="nc">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">m, 1</span><span class="o">]</span><span class="p">)</span><span class="o">+</span><span class="n">ferange</span><span class="o">*</span><span class="mf">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">m, 0</span><span class="o">]</span><span class="p">,</span>

<span class="w">                             </span><span class="n">fontsize</span><span class="o">=</span><span class="n">label_size</span><span class="p">,</span><span class="w"> </span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>

<span class="w">                             </span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">xlabel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                </span><span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;CV1 - {self.cv_name[0]}&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">)</span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span>

<span class="w">                </span><span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">ylabel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                </span><span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;free energy ({energy_unit})&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">)</span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span>

<span class="w">                </span><span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">)</span>

<span class="w">        </span><span class="n">elif</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cvs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="err">:</span>

<span class="w">            </span><span class="n">cv1min</span><span class="p">,</span><span class="w"> </span><span class="n">cv2min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_min</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_min</span><span class="o">[</span><span class="n">1</span><span class="o">]</span>

<span class="w">            </span><span class="n">cv1max</span><span class="p">,</span><span class="w"> </span><span class="n">cv2max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_max</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_max</span><span class="o">[</span><span class="n">1</span><span class="o">]</span>

<span class="w">            </span><span class="n">fig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">image_size</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">image_size</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">))</span>

<span class="w">            </span><span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">fes</span><span class="p">,</span><span class="w"> </span><span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)),</span><span class="w"> </span><span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span><span class="w"> </span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>

<span class="w">                       </span><span class="n">extent</span><span class="o">=[</span><span class="n">cv1min, cv1max, cv2min, cv2max</span><span class="o">]</span><span class="p">,</span>

<span class="w">                       </span><span class="n">aspect</span><span class="o">=</span><span class="p">(((</span><span class="n">cv1max</span><span class="o">-</span><span class="n">cv1min</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">cv2max</span><span class="o">-</span><span class="n">cv2min</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">aspect</span><span class="p">)),</span>

<span class="w">                       </span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="w"> </span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>

<span class="w">            </span><span class="n">cbar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">()</span>

<span class="w">            </span><span class="n">cbar</span><span class="p">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">energy_unit</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">shape</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">                </span><span class="n">background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color_map</span><span class="p">(</span>

<span class="w">                    </span><span class="p">(</span><span class="nc">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">)</span><span class="o">-</span><span class="n">vmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">vmax</span><span class="o">-</span><span class="n">vmin</span><span class="p">))</span>

<span class="w">                </span><span class="n">luma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">background</span><span class="o">[</span><span class="n">0</span><span class="o">]*</span><span class="mf">0.2126</span><span class="o">+</span><span class="n">background</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="err">\</span>

<span class="w">                    </span><span class="mf">0.7152</span><span class="o">+</span><span class="n">background</span><span class="o">[</span><span class="n">3</span><span class="o">]*</span><span class="mf">0.0722</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">luma</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.6</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">color_set</span><span class="p">:</span>

<span class="w">                    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;black&quot;</span>

<span class="w">                </span><span class="n">elif</span><span class="w"> </span><span class="n">luma</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.6</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">color_set</span><span class="p">:</span>

<span class="w">                    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;white&quot;</span>

<span class="w">                </span><span class="n">plt</span><span class="p">.</span><span class="nc">text</span><span class="p">(</span><span class="nc">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">0, 4</span><span class="o">]</span><span class="p">),</span><span class="w"> </span><span class="nc">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">0, 5</span><span class="o">]</span><span class="p">),</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">0, 0</span><span class="o">]</span><span class="p">,</span>

<span class="w">                         </span><span class="n">fontsize</span><span class="o">=</span><span class="n">label_size</span><span class="p">,</span><span class="w"> </span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>

<span class="w">                         </span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

<span class="w">            </span><span class="n">elif</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">shape</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">:, 0</span><span class="o">]</span><span class="p">))</span><span class="err">:</span>

<span class="w">                    </span><span class="n">background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color_map</span><span class="p">(</span>

<span class="w">                        </span><span class="p">(</span><span class="nc">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">m, 1</span><span class="o">]</span><span class="p">)</span><span class="o">-</span><span class="n">vmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">vmax</span><span class="o">-</span><span class="n">vmin</span><span class="p">))</span>

<span class="w">                    </span><span class="n">luma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">background</span><span class="o">[</span><span class="n">0</span><span class="o">]*</span><span class="mf">0.2126</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">\</span>

<span class="w">                        </span><span class="n">background</span><span class="o">[</span><span class="n">1</span><span class="o">]*</span><span class="mf">0.7152</span><span class="o">+</span><span class="n">background</span><span class="o">[</span><span class="n">3</span><span class="o">]*</span><span class="mf">0.0722</span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="n">luma</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.6</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">color_set</span><span class="p">:</span>

<span class="w">                        </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;black&quot;</span>

<span class="w">                    </span><span class="n">elif</span><span class="w"> </span><span class="n">luma</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.6</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">color_set</span><span class="p">:</span>

<span class="w">                        </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;white&quot;</span>

<span class="w">                    </span><span class="n">plt</span><span class="p">.</span><span class="nc">text</span><span class="p">(</span><span class="nc">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">m, 4</span><span class="o">]</span><span class="p">),</span><span class="w"> </span><span class="nc">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">m, 5</span><span class="o">]</span><span class="p">),</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">m, 0</span><span class="o">]</span><span class="p">,</span>

<span class="w">                             </span><span class="n">fontsize</span><span class="o">=</span><span class="n">label_size</span><span class="p">,</span><span class="w"> </span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>

<span class="w">                             </span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nl">contours</span><span class="p">:</span>

<span class="w">                </span><span class="n">cont</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="p">.</span><span class="n">contour</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">fes</span><span class="p">,</span><span class="w"> </span><span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)),</span>

<span class="w">                                   </span><span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span>

<span class="w">                                       </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">vmax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.01</span><span class="p">),</span><span class="w"> </span><span class="n">contours_spacing</span><span class="p">),</span>

<span class="w">                                   </span><span class="n">extent</span><span class="o">=[</span><span class="n">cv1min, cv1max, cv2max, cv2min</span><span class="o">]</span><span class="p">,</span>

<span class="w">                                   </span><span class="n">colors</span><span class="o">=</span><span class="ss">&quot;k&quot;</span><span class="p">)</span>

<span class="w">                </span><span class="n">plt</span><span class="p">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span>

<span class="w">                    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">vmax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.01</span><span class="p">),</span><span class="w"> </span><span class="n">contours_spacing</span><span class="p">))</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">xlabel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                </span><span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;CV1 - {self.cv_name[0]}&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">)</span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span>

<span class="w">                </span><span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">ylabel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                </span><span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;CV2 - {self.cv_name[1]}&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">)</span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span>

<span class="w">                </span><span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">)</span>

<span class="w">        </span><span class="n">elif</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cvs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="err">:</span>

<span class="w">            </span><span class="k">try</span><span class="err">:</span>

<span class="w">                </span><span class="n">import</span><span class="w"> </span><span class="n">pyvista</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">pv</span>

<span class="w">            </span><span class="ow">except</span><span class="w"> </span><span class="p">(</span><span class="n">ImportError</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleNotFoundError</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">e</span><span class="p">:</span>

<span class="w">                </span><span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="w">                </span><span class="n">sys</span><span class="p">.</span><span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="w">            </span><span class="n">cv1min</span><span class="p">,</span><span class="w"> </span><span class="n">cv2min</span><span class="p">,</span><span class="w"> </span><span class="n">cv3min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_min</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_min</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_min</span><span class="o">[</span><span class="n">2</span><span class="o">]</span>

<span class="w">            </span><span class="n">cv1max</span><span class="p">,</span><span class="w"> </span><span class="n">cv2max</span><span class="p">,</span><span class="w"> </span><span class="n">cv3max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_max</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_max</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_max</span><span class="o">[</span><span class="n">2</span><span class="o">]</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">xlabel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                </span><span class="n">xlabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;CV1 - &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_name</span><span class="o">[</span><span class="n">0</span><span class="o">]</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">ylabel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                </span><span class="n">ylabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;CV2 - &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_name</span><span class="o">[</span><span class="n">1</span><span class="o">]</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">zlabel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                </span><span class="n">zlabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;CV3 - &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">cv_name</span><span class="o">[</span><span class="n">2</span><span class="o">]</span>

<span class="w">            </span><span class="n">min_ar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">:, 5:8</span><span class="o">]</span><span class="p">.</span><span class="k">values</span>

<span class="w">            </span><span class="n">min_ar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min_ar</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>

<span class="w">            </span><span class="n">min_pv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pv</span><span class="p">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">min_ar</span><span class="p">)</span>

<span class="w">            </span><span class="n">grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pv</span><span class="p">.</span><span class="n">UniformGrid</span><span class="p">(</span>

<span class="w">                </span><span class="n">dimensions</span><span class="o">=</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="p">),</span>

<span class="w">                </span><span class="n">spacing</span><span class="o">=</span><span class="p">((</span><span class="n">cv1max</span><span class="o">-</span><span class="n">cv1min</span><span class="p">)</span><span class="o">/</span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">cv2max</span><span class="o">-</span><span class="n">cv2min</span><span class="p">)</span><span class="w"> </span><span class="o">/</span>

<span class="w">                         </span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">cv3max</span><span class="o">-</span><span class="n">cv3min</span><span class="p">)</span><span class="o">/</span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="p">),</span>

<span class="w">                </span><span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="n">cv1min</span><span class="p">,</span><span class="w"> </span><span class="n">cv2min</span><span class="p">,</span><span class="w"> </span><span class="n">cv3min</span><span class="p">)</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="n">grid</span><span class="o">[</span><span class="n">&quot;vol&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">fes</span><span class="p">.</span><span class="n">ravel</span><span class="p">(</span><span class="k">order</span><span class="o">=</span><span class="ss">&quot;F&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                </span><span class="n">contours</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid</span><span class="p">.</span><span class="n">contour</span><span class="p">(</span>

<span class="w">                    </span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">vmax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.1</span><span class="p">),</span><span class="w"> </span><span class="n">contours_spacing</span><span class="p">))</span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span>

<span class="w">                </span><span class="n">contours</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid</span><span class="p">.</span><span class="n">contour</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>

<span class="w">            </span><span class="n">fescolors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="n">contours</span><span class="p">.</span><span class="n">points</span><span class="p">.</span><span class="n">shape</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">)</span><span class="err">:</span>

<span class="w">                </span><span class="n">fescolors</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">fes</span><span class="o">[</span><span class="n">int((contours.points[i, 0</span><span class="o">]-</span><span class="n">cv1min</span><span class="p">)</span><span class="o">*</span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="o">/</span><span class="p">(</span><span class="n">cv1max</span><span class="o">-</span><span class="n">cv1min</span><span class="p">)),</span>

<span class="w">                                          </span><span class="nc">int</span><span class="p">((</span>

<span class="w">                                              </span><span class="n">contours</span><span class="p">.</span><span class="n">points</span><span class="o">[</span><span class="n">i, 1</span><span class="o">]-</span><span class="n">cv2min</span><span class="p">)</span><span class="o">*</span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="o">/</span><span class="p">(</span><span class="n">cv2max</span><span class="o">-</span><span class="n">cv2min</span><span class="p">)),</span>

<span class="w">                                          </span><span class="nc">int</span><span class="p">((</span><span class="n">contours</span><span class="p">.</span><span class="n">points</span><span class="o">[</span><span class="n">i, 2</span><span class="o">]-</span><span class="n">cv3min</span><span class="p">)</span><span class="o">*</span><span class="n">self</span><span class="p">.</span><span class="n">res</span><span class="o">/</span><span class="p">(</span><span class="n">cv3max</span><span class="o">-</span><span class="n">cv3min</span><span class="p">))</span><span class="err">]</span><span class="p">)</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="n">Visualization</span>

<span class="w">            </span><span class="n">pv</span><span class="p">.</span><span class="n">set_plot_theme</span><span class="p">(</span><span class="s1">&#39;document&#39;</span><span class="p">)</span>

<span class="w">            </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pv</span><span class="p">.</span><span class="n">Plotter</span><span class="p">()</span>

<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span><span class="w"> </span><span class="n">scalars</span><span class="o">=</span><span class="n">fescolors</span><span class="p">,</span><span class="w"> </span><span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>

<span class="w">                       </span><span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span><span class="w"> </span><span class="n">show_scalar_bar</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="w"> </span><span class="n">interpolate_before_map</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>

<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="n">show_grid</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span><span class="w"> </span><span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span><span class="w"> </span><span class="n">zlabel</span><span class="o">=</span><span class="n">zlabel</span><span class="p">)</span>

<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="n">add_point_labels</span><span class="p">(</span><span class="n">min_pv</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">minima</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">:, 0</span><span class="o">]</span><span class="p">,</span>

<span class="w">                               </span><span class="n">show_points</span><span class="o">=</span><span class="n">show_points</span><span class="p">,</span><span class="w"> </span><span class="n">always_visible</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>

<span class="w">                               </span><span class="n">point_color</span><span class="o">=</span><span class="ss">&quot;black&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">point_size</span><span class="o">=</span><span class="n">point_size</span><span class="p">,</span>

<span class="w">                               </span><span class="n">font_size</span><span class="o">=</span><span class="n">label_size</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="o">=</span><span class="k">None</span><span class="p">)</span>

<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">png_name</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">png_name</span><span class="p">)</span>
</code></pre></div>

</details>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        
<footer class="md-footer">
    
      <nav class="md-footer__inner md-grid" aria-label="Footer">
        
          
          <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: Index" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Previous
                </span>
                Index
              </div>
            </div>
          </a>
        
        
          
          <a href="../profile/" class="md-footer__link md-footer__link--next" aria-label="Next: Profile" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                Profile
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
            
            Powered by
            <a href="http://timothycrosley.github.io/portray">portray.</a>
            You too can
            <a href="http://timothycrosley.github.io/portray">
              portray</a>
            your Python project well using automatic documentation.
          </div>
        
      </div>
    </div>
  </footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>